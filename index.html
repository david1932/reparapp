<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Gesti√≥n de Clientes y Reparaciones">
    <title>ReparApp - Clientes y Reparaciones</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/mobile.css" media="(max-width: 1024px)">
    <link rel="stylesheet" href="css/print.css">
    <link rel="stylesheet" href="styles/toast_styles.css">
    <link rel="manifest" href="manifest.json">
    <!-- PWA -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    <div id="app-container" class="app-container">
        <!-- Mobile Top Bar (Hidden on desktop via CSS) -->
        <div class="mobile-top-bar">
            <div class="mobile-logo">ReparApp</div>
            <button class="btn-sync-mobile" id="btn-sync-mobile" title="Sincronizar" data-i18n="nav_sync"
                ontouchstart="if(window.syncManager) window.syncManager.sync();"
                onclick="if(window.syncManager) window.syncManager.sync();">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
                    <path d="M16 21h5v-5"></path>
                </svg>
            </button>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">ReparApp</div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <span data-i18n="nav_dashboard">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-view="clientes">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span data-i18n="nav_clientes">Clientes</span>
                </a>
                <a href="#" class="nav-item" data-view="reparaciones">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z">
                        </path>
                    </svg>
                    <span data-i18n="nav_reparaciones">Reparaciones</span>
                </a>
                <a href="#" class="nav-item" data-view="facturas">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span data-i18n="nav_facturas">Facturas</span>
                </a>
                <a href="#" class="nav-item" data-view="citas">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <span data-i18n="nav_citas">Citas</span>
                </a>
                <a href="#" class="nav-item" data-view="inventory">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path
                            d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                        </path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    <span data-i18n="nav_inventario">Inventario</span>
                </a>
                <a href="#" class="nav-item" data-view="pos">
                    <span class="nav-icon">üõí</span>
                    <span data-i18n="nav_pos">Caja / TPV</span>
                </a>
                <a href="#" class="nav-item" data-view="gestor" id="nav-gestor">
                    <span class="nav-icon">üíº</span>
                    <span data-i18n="nav_gestor">Gestor</span>
                    <span style="font-size: 10px; margin-left: 5px;">üîí</span>
                </a>
                <a href="#" class="nav-item" data-view="settings">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                    <span data-i18n="nav_ajustes">Ajustes</span>
                </a>
            </nav>

            <div class="sync-section">
                <button class="btn-sync" id="btn-sync">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <polyline points="1 20 1 14 7 14"></polyline>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                    <span data-i18n="nav_sync">Sincronizar</span>
                </button>
                <p style="text-align: center; margin-top: 8px; font-size: 0.75rem; color: var(--text-muted);"
                    id="sync-status" data-i18n="nav_sync_status">Sin sincronizar</p>

                <!-- Divider -->
                <div style="height: 1px; background: var(--border-color); margin: 15px 0;"></div>

                <!-- User Info -->
                <div id="current-user-display"
                    style="text-align: center; font-size: 0.85rem; color: var(--text-primary); margin-bottom: 8px; font-weight: 500;">
                    <!-- Name injected by js -->
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                    <button class="btn btn-secondary btn-sm" id="btn-logout"
                        style="width: 100%; justify-content: center; gap: 8px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        <span data-i18n="nav_logout">Cerrar Sesi√≥n</span>
                    </button>
                </div>
            </div>

        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div class="view active" id="view-dashboard">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="dash_title">Dashboard</h1>
                </header>
                <div class="content-body">
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <h4 id="stat-clientes">0</h4>
                                <p data-i18n="dash_stat_clients">Clientes</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path
                                        d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z">
                                    </path>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <h4 id="stat-reparaciones">0</h4>
                                <p data-i18n="dash_stat_repairs">Reparaciones</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon cyan">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="stat-info">
                                <h4 id="stat-completadas">0</h4>
                                <p data-i18n="dash_stat_completed">Completadas</p>
                            </div>
                        </div>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                        <h2 style="margin-bottom: 0;" data-i18n="dash_recent_repairs">Reparaciones Recientes</h2>
                        <div class="view-mode-toggle">
                            <button class="btn-icon mode-list" title="Lista" data-i18n-title="title_list">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="btn-icon mode-small" title="Mosaico Peque√±o"
                                data-i18n-title="title_mosaic_small">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="btn-icon mode-large active" title="Mosaico Grande"
                                data-i18n-title="title_mosaic_large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="cards-grid" id="dashboard-repairs">
                        <!-- Reparaciones recientes se cargan aqu√≠ -->
                    </div>
                </div>
            </div>

            <!-- VISTA GESTOR (HACIENDA) -->
            <div id="view-gestor" class="view" style="overflow-y: auto; height: 100%;">
                <!-- Styled Header -->
                <header class="content-header" style="margin-bottom: 24px;">
                    <div>
                        <h1 class="page-title" style="display: flex; align-items: center; gap: 12px;">
                            <span style="font-size: 1.5em;">üíº</span> <span data-i18n="ges_title">Gestor Fiscal</span>
                        </h1>
                        <p class="text-subtitle" style="color: var(--text-secondary); margin-top: 4px;">
                            <span data-i18n="ges_subtitle">Control de gastos, ingresos y obligaciones fiscales
                                (Hacienda)</span>
                        </p>
                    </div>

                </header>

                <!-- Panel: Resumen Fiscal (Windowed) -->
                <div class="gestor-panel"
                    style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 24px; margin-bottom: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                    <div class="panel-header"
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">üìä</span>
                            <h2 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--text-primary);"
                                data-i18n="ges_quarterly_summary" id="ges-summary-title">Resumen
                                Trimestral</h2>
                        </div>
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <!-- International Mode Toggle -->
                            <label
                                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); cursor: pointer;">
                                <input type="checkbox" id="gestor-intl-mode">
                                <span data-i18n="ges_intl_mode">Intl. Mode</span>
                            </label>
                            <!-- Report View Toggle -->
                            <label
                                style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); cursor: pointer;">
                                <span data-i18n="ges_view_annual">Anual</span>
                                <input type="checkbox" id="gestor-report-view">
                                <span data-i18n="ges_view_monthly">Mensual</span>
                            </label>
                        </div>
                    </div>
                    <div class="grid-dashboard"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div class="stat-card"
                            style="background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üßæ</div>
                            <div class="stat-title label-iva-pay"
                                style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;"
                                data-i18n="ges_tax_iva_pay">IVA a
                                Pagar (Mod. 303)</div>
                            <div class="stat-value" id="tax-iva-balance"
                                style="font-size: 1.75rem; font-weight: 700; color: var(--electric-cyan);">0.00 ‚Ç¨</div>
                            <div class="stat-change label-breakdown"
                                style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"
                                data-i18n="ges_iva_breakdown">Devengado -
                                Deducible</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üí∞</div>
                            <div class="stat-title label-irpf"
                                style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;"
                                data-i18n="ges_tax_irpf">IRPF (Mod. 130)</div>
                            <div class="stat-value" id="tax-irpf-balance"
                                style="font-size: 1.75rem; font-weight: 700; color: var(--electric-purple);">0.00 ‚Ç¨
                            </div>
                            <div class="stat-change"
                                style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"
                                data-i18n="ges_irpf_breakdown">Pago fracc. est.</div>
                        </div>
                        <div class="stat-card"
                            style="background: var(--bg-card); border-radius: 12px; padding: 20px; border: 1px solid var(--border-color); text-align: center;">
                            <div style="font-size: 2rem; margin-bottom: 8px;">üìà</div>
                            <div class="stat-title label-net-result"
                                style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;"
                                data-i18n="ges_net_result">Resultado Neto</div>
                            <div class="stat-value" id="tax-net-result"
                                style="font-size: 1.75rem; font-weight: 700; color: var(--status-success);">0.00 ‚Ç¨</div>
                            <div class="stat-change"
                                style="font-size: 0.75rem; color: var(--text-muted); margin-top: 4px;"
                                data-i18n="ges_net_breakdown">Ingresos - Gastos</div>
                        </div>
                    </div>
                    <!-- Export Controls -->
                    <div
                        style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color); display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                        <span style="font-size: 0.85rem; color: var(--text-secondary);"
                            data-i18n="ges_export_title">Exportar:</span>
                        <select id="export-month-select" class="form-select" style="width: 120px;">
                            <option value="1" data-i18n="month_jan">Enero</option>
                            <option value="2" data-i18n="month_feb">Febrero</option>
                            <option value="3" data-i18n="month_mar">Marzo</option>
                            <option value="4" data-i18n="month_apr">Abril</option>
                            <option value="5" data-i18n="month_may">Mayo</option>
                            <option value="6" data-i18n="month_jun">Junio</option>
                            <option value="7" data-i18n="month_jul">Julio</option>
                            <option value="8" data-i18n="month_aug">Agosto</option>
                            <option value="9" data-i18n="month_sep">Septiembre</option>
                            <option value="10" data-i18n="month_oct">Octubre</option>
                            <option value="11" data-i18n="month_nov">Noviembre</option>
                            <option value="12" data-i18n="month_dec">Diciembre</option>
                        </select>
                        <button class="btn btn-secondary btn-sm" id="btn-export-month"
                            data-i18n="ges_export_month">Mes</button>
                        <button class="btn btn-secondary btn-sm" id="btn-export-quarter"
                            data-i18n="ges_export_quarter">Trimestre</button>
                        <button class="btn btn-secondary btn-sm" id="btn-export-year"
                            data-i18n="ges_export_year">A√±o</button>
                    </div>
                </div>

                <!-- Panel: Filtros y Datos (Windowed) -->
                <div class="gestor-panel"
                    style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.15);">
                    <div class="panel-header"
                        style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color);">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">üìã</span>
                            <h2 style="margin: 0; font-size: 1.1rem; font-weight: 600; color: var(--text-primary);"
                                data-i18n="ges_movements">
                                Movimientos</h2>
                        </div>
                        <!-- Filtros Trimestre -->
                        <div id="gestor-quarter-container" class="filters-bar"
                            style="display: flex; gap: 12px; align-items: center;">
                            <select id="gestor-quarter" class="form-select"
                                style="min-width: 180px; background: var(--bg-secondary); border-radius: 8px;">
                                <!-- JS will populate -->
                            </select>
                            <select id="gestor-year" class="form-select"
                                style="min-width: 100px; background: var(--bg-secondary); border-radius: 8px;">
                                <!-- JS will populate -->
                            </select>
                        </div>
                    </div>

                    <!-- ========== CONTENEDOR LADO A LADO ========== -->
                    <div class="gestor-split-container"
                        style="display: flex; gap: 20px; height: calc(100vh - 380px); min-height: 400px;">

                        <!-- ========== PANEL GASTOS ========== -->
                        <div class="gestor-panel"
                            style="flex: 1; background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(168, 85, 247, 0.08)); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 16px; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
                            <!-- Header del Panel Gastos -->
                            <div
                                style="background: linear-gradient(135deg, #8b5cf6, #a855f7); padding: 5px 20px; display: flex; justify-content: space-between; align-items: center; height: 70px; box-sizing: border-box;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 1.5rem;">üìâ</span>
                                    <div>
                                        <h3 style="margin: 0; font-size: 1rem; font-weight: 700; color: white;"
                                            data-i18n="ges_expenses_title">Gastos
                                            / Facturas Recibidas</h3>
                                        <p style="margin: 2px 0 0 0; font-size: 0.75rem; color: rgba(255,255,255,0.8);"
                                            data-i18n="ges_expenses_subtitle">
                                            IVA Soportado deducible (Mod. 303)</p>
                                    </div>
                                </div>
                                <button class="btn" id="btn-add-gasto" onclick="window.managerUI.openModal();"
                                    style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0 12px; height: 32px; font-weight: 600; font-size: 0.9rem; gap: 8px; display: flex; align-items: center;">
                                    <span>‚ûï</span> <span data-i18n="ges_btn_add_expense">A√±adir Gasto</span>
                                </button>
                            </div>
                            <!-- Contenido Gastos (scrollable) -->
                            <div style="padding: 20px; flex: 1; overflow-y: auto;">
                                <div id="gastos-list">
                                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: rgba(139, 92, 246, 0.1);">
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_date">
                                                    Fecha</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_provider">
                                                    Proveedor</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_concept">
                                                    Concepto</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_base">
                                                    Base</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_tax">
                                                    IVA</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #a855f7;"
                                                    data-i18n="ges_th_total">
                                                    Total</th>
                                                <th style="padding: 12px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="gastos-tbody"></tbody>
                                    </table>
                                    <div id="gastos-empty"
                                        style="text-align: center; padding: 30px; color: var(--text-secondary); display: none;">
                                        <span style="font-size: 2rem;">üìã</span>
                                        <p style="margin: 8px 0 0 0;" data-i18n="ges_empty_expenses">No hay gastos
                                            registrados en este trimestre</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ========== PANEL INGRESOS ========== -->
                        <div class="gestor-panel"
                            style="flex: 1; background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(34, 197, 94, 0.08)); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 16px; padding: 0; overflow: hidden; display: flex; flex-direction: column;">
                            <!-- Header del Panel Ingresos -->
                            <div
                                style="background: linear-gradient(135deg, #10b981, #22c55e); padding: 5px 20px; display: flex; justify-content: space-between; align-items: center; height: 70px; box-sizing: border-box;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <span style="font-size: 1.5rem;">üìà</span>
                                    <div>
                                        <h3 style="margin: 0; font-size: 1rem; font-weight: 700; color: white;"
                                            data-i18n="ges_income_title">
                                            Ingresos / Facturas Emitidas</h3>
                                        <p style="margin: 2px 0 0 0; font-size: 0.75rem; color: rgba(255,255,255,0.8);"
                                            data-i18n="ges_income_subtitle">
                                            IVA Repercutido a declarar (Mod. 303)</p>
                                    </div>
                                </div>
                                <!-- Botones Header Ingresos -->
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn" id="btn-sync-ingresos"
                                        onclick="window.managerUI.syncIngresos();" title="Sincronizar Facturas"
                                        data-i18n-title="ges_btn_sync_income"
                                        style="background: rgba(0, 255, 198, 0.15); border: 1px solid var(--electric-cyan); color: var(--electric-cyan); height: 32px; width: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 8px; cursor: pointer;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                            <path d="M3 3v5h5"></path>
                                            <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path>
                                            <path d="M16 21h5v-5"></path>
                                        </svg>
                                    </button>
                                    <button class="btn" id="btn-add-ingreso"
                                        onclick="window.managerUI.addManualIncome();"
                                        style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 0 12px; height: 32px; font-weight: 600; font-size: 0.9rem; gap: 8px; display: flex; align-items: center;">
                                        <span>‚ûï</span> <span data-i18n="ges_btn_add_income">A√±adir Ingreso</span>
                                    </button>
                                </div>
                            </div>
                            <!-- Contenido Ingresos (scrollable) -->
                            <div style="padding: 20px; flex: 1; overflow-y: auto;">
                                <div id="ingresos-list">
                                    <table class="data-table" style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background: rgba(16, 185, 129, 0.1);">
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_date">
                                                    Fecha</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_inv_num">
                                                    N¬∫ Factura</th>
                                                <th style="padding: 12px; text-align: left; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_client">
                                                    Cliente</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_base">
                                                    Base</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_tax">
                                                    IVA</th>
                                                <th style="padding: 12px; text-align: right; font-weight: 600; color: #10b981;"
                                                    data-i18n="ges_table_total">
                                                    Total</th>
                                                <th style="padding: 12px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="ingresos-tbody"></tbody>
                                    </table>
                                    <div id="ingresos-empty"
                                        style="text-align: center; padding: 30px; color: var(--text-secondary); display: none;">
                                        <span style="font-size: 2rem;">üìã</span>
                                        <p style="margin: 8px 0 0 0;" data-i18n="ges_empty_income">No hay ingresos
                                            registrados en este trimestre</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div> <!-- END view-gestor REAL -->

            <!-- MODAL NUEVO GASTO -->
            <div class="modal-overlay" id="modal-gasto">
                <div class="modal" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2 class="modal-title" data-i18n="mod_expense_title">Registrar Gasto</h2>
                        <button class="modal-close" data-close-modal="modal-gasto">&times;</button>
                    </div>
                    <div class="modal-body" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <!-- Columna Izq: Formulario -->
                        <form id="form-gasto">
                            <input type="hidden" id="gasto-id">

                            <div class="form-group">
                                <label class="form-label" data-i18n="mod_expense_date">Fecha Factura</label>
                                <input type="date" id="gasto-fecha" class="form-input" required>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="mod_expense_quarter">Trimestre</label>
                                    <select id="gasto-trimestre" class="form-select">
                                        <option value="1T" data-i18n="ges_q1">1T (Ene-Mar)</option>
                                        <option value="2T" data-i18n="ges_q2">2T (Abr-Jun)</option>
                                        <option value="3T" data-i18n="ges_q3">3T (Jul-Sep)</option>
                                        <option value="4T" data-i18n="ges_q4">4T (Oct-Dic)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="mod_expense_year">A√±o</label>
                                    <input type="number" id="gasto-anio" class="form-input">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-i18n="mod_expense_provider">Proveedor</label>
                                <input type="text" id="gasto-proveedor" class="form-input" placeholder="Nombre empresa"
                                    data-i18n-placeholder="mod_expense_provider_placeholder" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="mod_expense_nif">NIF/CIF</label>
                                <input type="text" id="gasto-nif" class="form-input" placeholder="B12345678"
                                    data-i18n-placeholder="mod_expense_nif_placeholder">
                            </div>
                            <div class="form-group">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <label class="form-label" style="margin:0;"
                                        data-i18n="mod_expense_concepts">Conceptos</label>
                                    <button type="button" id="btn-add-concepto-row"
                                        style="background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px; padding: 2px 8px; font-size: 0.8rem; cursor: pointer;">
                                        + A√±adir
                                    </button>
                                </div>
                                <div id="gasto-conceptos-container"
                                    style="display: flex; flex-direction: column; gap: 8px;">
                                    <!-- Dynamic Rows -->
                                    <input type="text" class="form-input concepto-input" placeholder="Concepto general"
                                        data-i18n-placeholder="mod_expense_concept_placeholder">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-i18n="mod_expense_total">Importe Total (con IVA)</label>
                                <input type="number" step="0.01" id="gasto-total" class="form-input" placeholder="0.00"
                                    required>
                            </div>

                            <!-- Desglose IVA -->
                            <div style="background: #f9f9f9; padding: 10px; border-radius: 8px; margin-top: 10px;">
                                <div class="form-group">
                                    <label class="form-label" id="label-gasto-tax" data-i18n="mod_expense_tax_type">Tipo
                                        IVA Soportado</label>
                                    <select id="gasto-iva-type" class="form-select">
                                        <option value="21">21% (General)</option>
                                        <option value="10">10% (Reducido)</option>
                                        <option value="4">4% (Superreducido)</option>
                                        <option value="0">0% (Exento)</option>
                                    </select>
                                </div>
                                <div
                                    style="display: flex; justify-content: space-between; font-size: 0.85rem; color: #666;">
                                    <span data-i18n="mod_expense_base_label">Base Imponible:</span> <b
                                        id="gasto-calc-base">0.00 ‚Ç¨</b>
                                    <span data-i18n="mod_expense_tax_label">Cuota IVA:</span> <b
                                        id="gasto-calc-iva">0.00 ‚Ç¨</b>
                                </div>
                            </div>

                            <!-- Categor√≠a Gasto -->
                            <div class="form-group" style="margin-top: 10px;">
                                <label class="form-label" data-i18n="mod_expense_category">Categor√≠a del Gasto</label>
                                <select id="gasto-categoria" class="form-select">
                                    <option value="material" data-i18n="mod_expense_cat_material">üì¶ Material /
                                        Mercanc√≠as</option>
                                    <option value="servicios" data-i18n="mod_expense_cat_services">üîß Servicios
                                        Profesionales</option>
                                    <option value="suministros" data-i18n="mod_expense_cat_supplies">üí° Suministros
                                        (luz, agua, tel√©fono)</option>
                                    <option value="alquiler" data-i18n="mod_expense_cat_rent">üè† Alquiler Local</option>
                                    <option value="transporte" data-i18n="mod_expense_cat_transport">üöó Transporte /
                                        Combustible</option>
                                    <option value="seguros" data-i18n="mod_expense_cat_insurance">üõ°Ô∏è Seguros</option>
                                    <option value="financiero" data-i18n="mod_expense_cat_financial">üè¶ Gastos
                                        Financieros</option>
                                    <option value="otros" data-i18n="mod_expense_cat_others">üìã Otros Gastos</option>
                                </select>
                            </div>

                            <!-- Deducible IRPF -->
                            <div class="form-group" style="margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="gasto-deducible-irpf" checked>
                                    <span class="form-label" style="margin: 0;" id="label-gasto-deducible"
                                        data-i18n="mod_expense_deducible">Deducible para IRPF (Modelo
                                        130)</span>
                                </label>
                            </div>

                            <div style="margin-top: 20px; text-align: right;">
                                <button type="submit" class="btn btn-primary" data-i18n="mod_expense_btn_save">Guardar
                                    Gasto</button>
                            </div>
                        </form>

                        <!-- Columna Der: Esc√°ner Ticket -->
                        <div style="border-left: 1px solid #eee; padding-left: 20px;">
                            <h3 data-i18n="mod_ocr_title">Escanear Ticket</h3>
                            <p class="text-subtitle" data-i18n="mod_ocr_subtitle">Captura o selecciona una imagen del
                                ticket.</p>

                            <!-- Visor de C√°mara -->
                            <div id="ocr-camera-box"
                                style="width: 100%; height: 260px; background: #000; border-radius: 8px; overflow: hidden; position: relative; margin-bottom: 15px; border: 2px solid var(--border-color); display: flex; align-items: center; justify-content: center;">
                                <div id="ocr-placeholder"
                                    style="color: #666; font-size: 0.9rem; position: absolute; display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                    <span style="font-size: 2rem;">üì∏</span>
                                    <span>C√°mara Apagada</span>
                                </div>
                                <video id="ocr-video" autoplay playsinline
                                    style="width: 100%; height: 100%; object-fit: cover; display: none;"></video>
                                <canvas id="ocr-canvas" style="display: none;"></canvas>
                                <!-- Gu√≠a visual -->
                                <div id="ocr-guide"
                                    style="position: absolute; top: 10%; left: 10%; right: 10%; bottom: 10%; border: 2px dashed rgba(255,255,255,0.3); border-radius: 8px; pointer-events: none; display: none;">
                                </div>
                            </div>

                            <!-- Botones Principales -->
                            <div style="display: flex; gap: 12px; margin-bottom: 15px;">
                                <!-- Bot√≥n Izquierda: Tomar Foto (Webcam) -->
                                <button id="btn-ocr-webcam" class="btn btn-primary"
                                    style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; height: auto;">
                                    <span style="font-size: 1.5rem; margin-bottom: 5px;">üì∑</span>
                                    <span id="txt-ocr-webcam" style="font-weight: 600;">Tomar Foto</span>
                                </button>

                                <!-- Bot√≥n Derecha: Seleccionar Foto (Archivo) -->
                                <button id="btn-ocr-upload" class="btn btn-secondary"
                                    style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 15px; height: auto; background: var(--success-color); border-color: var(--success-color); color: white;"
                                    onclick="document.getElementById('ocr-file-input').click()">
                                    <span style="font-size: 1.5rem; margin-bottom: 5px;">üìÇ</span>
                                    <span style="font-weight: 600;">Seleccionar Foto</span>
                                </button>
                            </div>

                            <input type="file" id="ocr-file-input" accept="image/*" style="display: none;">

                            <!-- Status -->
                            <div id="ocr-status"
                                style="border: 1px dashed var(--border-color); border-radius: 8px; padding: 10px; font-weight: bold; font-size: 0.85rem; color: var(--accent-color); text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">
                                Esperando acci√≥n...
                            </div>
                            <div id="ocr-debug" style="display: none;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL NUEVO INGRESO (Factura Emitida) -->
            <div class="modal-overlay" id="modal-ingreso">
                <div class="modal" style="max-width: 600px;">
                    <div class="modal-header" style="background: linear-gradient(135deg, #10b981, #22c55e);">
                        <h2 class="modal-title" data-i18n="mod_income_title">üìà Registrar Ingreso / Factura Emitida</h2>
                        <button class="modal-close" data-close-modal="modal-ingreso">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-ingreso">
                            <input type="hidden" id="ingreso-id">

                            <!-- Fila 1: Fecha y N¬∫ Factura -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="mod_income_date">Fecha Factura</label>
                                    <input type="date" id="ingreso-fecha" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="mod_income_number">N¬∫ Factura</label>
                                    <input type="text" id="ingreso-nfactura" class="form-input" placeholder="2024/001"
                                        data-i18n-placeholder="mod_income_number_placeholder">
                                </div>
                            </div>

                            <!-- Fila 2: Trimestre y A√±o (auto) -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div class="form-group">
                                    <label class="form-label">Trimestre</label>
                                    <select id="ingreso-trimestre" class="form-select">
                                        <option value="1T">1T (Ene-Mar)</option>
                                        <option value="2T">2T (Abr-Jun)</option>
                                        <option value="3T">3T (Jul-Sep)</option>
                                        <option value="4T">4T (Oct-Dic)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">A√±o</label>
                                    <input type="number" id="ingreso-anio" class="form-input">
                                </div>
                            </div>

                            <!-- Cliente -->
                            <div class="form-group">
                                <label class="form-label">Cliente</label>
                                <input type="text" id="ingreso-cliente" class="form-input"
                                    placeholder="Nombre o raz√≥n social"
                                    data-i18n-placeholder="mod_income_client_placeholder" required>
                            </div>

                            <!-- NIF/CIF Cliente -->
                            <div class="form-group">
                                <label class="form-label">NIF/CIF Cliente</label>
                                <input type="text" id="ingreso-nif" class="form-input"
                                    placeholder="12345678A o B12345678"
                                    data-i18n-placeholder="mod_income_nif_placeholder">
                            </div>

                            <!-- Concepto -->
                            <div class="form-group">
                                <label class="form-label">Concepto / Descripci√≥n</label>
                                <input type="text" id="ingreso-concepto" class="form-input"
                                    placeholder="Reparaci√≥n m√≥vil, Servicio t√©cnico..."
                                    data-i18n-placeholder="mod_income_concept_placeholder" required>
                            </div>

                            <!-- Desglose Econ√≥mico -->
                            <div
                                style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(34, 197, 94, 0.1)); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid rgba(34, 197, 94, 0.2);">
                                <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: #10b981;">üí∞ Desglose
                                    Econ√≥mico</h4>

                                <!-- Base Imponible -->
                                <div class="form-group">
                                    <label class="form-label">Base Imponible (sin IVA)</label>
                                    <input type="number" step="0.01" id="ingreso-base" class="form-input"
                                        placeholder="0.00" required>
                                </div>

                                <!-- Tipo IVA -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group">
                                        <label class="form-label">Tipo IVA Repercutido</label>
                                        <select id="ingreso-iva-type" class="form-select">
                                            <option value="21">21% (General)</option>
                                            <option value="10">10% (Reducido)</option>
                                            <option value="4">4% (Superreducido)</option>
                                            <option value="0">0% (Exento)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Cuota IVA</label>
                                        <input type="text" id="ingreso-calc-iva" class="form-input" readonly
                                            style="background: #f0f0f0; color: #333; font-weight: 600;">
                                    </div>
                                </div>

                                <!-- Retenci√≥n IRPF -->
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div class="form-group">
                                        <label class="form-label">Retenci√≥n IRPF</label>
                                        <select id="ingreso-irpf-type" class="form-select">
                                            <option value="0">0% (Sin retenci√≥n)</option>
                                            <option value="7">7% (Nuevos aut√≥nomos)</option>
                                            <option value="15">15% (General)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Retenci√≥n</label>
                                        <input type="text" id="ingreso-calc-irpf" class="form-input" readonly
                                            style="background: #f0f0f0; color: #333; font-weight: 600;">
                                    </div>
                                </div>

                                <!-- Total Factura -->
                                <div
                                    style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(34, 197, 94, 0.3);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="font-weight: 600; color: #10b981;"
                                            data-i18n="mod_income_total_label">TOTAL FACTURA:</span>
                                        <span id="ingreso-calc-total"
                                            style="font-size: 1.3rem; font-weight: 700; color: #10b981;">0.00
                                            ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                <button type="button" class="btn btn-secondary" data-close-modal="modal-ingreso"
                                    data-i18n="mod_cancel">Cancelar</button>
                                <button type="submit" class="btn btn-primary" data-i18n="mod_income_btn_save">Guardar
                                    Ingreso</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div> <!-- END modal-ingreso overlay -->

            <!-- MODAL NUEVA CITA -->
            <div class="modal-overlay" id="modal-cita">
                <div class="modal" style="max-width: 500px;">
                    <div class="modal-header">
                        <h2 class="modal-title">Nueva Cita</h2>
                        <button class="modal-close" data-close-modal="modal-cita">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-cita">
                            <input type="hidden" id="cita-id">

                            <div class="form-group">
                                <label class="form-label">Cliente</label>
                                <select id="cita-cliente-select" class="form-select" required style="width: 100%;">
                                    <option value="">Seleccionar Cliente...</option>
                                </select>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div class="form-group">
                                    <label class="form-label">Fecha</label>
                                    <input type="date" id="cita-fecha" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Hora</label>
                                    <input type="time" id="cita-hora" class="form-input" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Motivo / Servicio</label>
                                <input type="text" id="cita-motivo" class="form-input"
                                    placeholder="Ej: Cambio de pantalla, Revisi√≥n...">
                            </div>

                            <div class="form-group">
                                <label class="form-label">Notas</label>
                                <textarea id="cita-notas" class="form-textarea" style="min-height: 80px;"
                                    placeholder="Detalles adicionales..."></textarea>
                            </div>

                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-close-modal="modal-cita">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Cita</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Clientes View -->
            <div class="view" id="view-clientes">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="cli_title">Clientes</h1>
                    <div class="header-actions">
                        <div class="search-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" id="search-clientes" autocomplete="off"
                                placeholder="Buscar por nombre o tel√©fono..."
                                data-i18n-placeholder="cli_search_placeholder">
                        </div>
                        <div class="view-mode-toggle">
                            <button class="btn-icon mode-list" title="Lista" data-i18n-title="title_list">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="btn-icon mode-small" title="Mosaico Peque√±o"
                                data-i18n-title="title_mosaic_small">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="btn-icon mode-large active" title="Mosaico Grande"
                                data-i18n-title="title_mosaic_large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="btn-add-cliente">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span data-i18n="cli_btn_new">Nuevo Cliente</span>
                        </button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="cards-grid" id="clientes-grid">
                        <!-- Clientes se cargan aqu√≠ -->
                    </div>
                    <div class="empty-state" id="empty-clientes" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                        </svg>
                        <h3 data-i18n="cli_empty_title">No hay clientes</h3>
                        <p data-i18n="cli_empty_subtitle">A√±ade tu primer cliente para comenzar</p>
                    </div>
                </div>
            </div>

            <!-- Reparaciones View -->
            <div class="view" id="view-reparaciones">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="rep_title">Reparaciones</h1>
                    <div class="header-actions">
                        <div class="search-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" id="search-reparaciones" autocomplete="off"
                                placeholder="Buscar reparaci√≥n..." data-i18n-placeholder="rep_search_placeholder">
                        </div>
                        <select class="form-select" id="filter-estado" style="width: 150px;">
                            <option value="" data-i18n="filter_all">Todos</option>
                            <option value="recibido" data-i18n="st_recibido">Recibido</option>
                            <option value="diagnostico" data-i18n="st_diagnostico">En Diagn√≥stico</option>
                            <option value="reparando" data-i18n="st_reparando">Reparando</option>
                            <option value="listo" data-i18n="st_listo">Listo</option>
                            <option value="cancelado" data-i18n="st_cancelado">Cancelado</option>
                        </select>
                        <div class="view-mode-toggle">
                            <button class="btn-icon mode-list" title="Lista" data-i18n-title="title_list">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="btn-icon mode-small" title="Mosaico Peque√±o"
                                data-i18n-title="title_mosaic_small">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="btn-icon mode-large active" title="Mosaico Grande"
                                data-i18n-title="title_mosaic_large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="btn-add-reparacion"
                            ontouchstart="if(window.repairsUI) window.repairsUI.openModal();"
                            onclick="if(window.repairsUI) window.repairsUI.openModal(); else console.error('RepairsUI not ready');">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span data-i18n="rep_btn_new">Nueva Reparaci√≥n</span>
                        </button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="cards-grid" id="reparaciones-grid">
                        <!-- Reparaciones se cargan aqu√≠ -->
                    </div>
                    <div class="empty-state" id="empty-reparaciones" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z">
                            </path>
                        </svg>
                        <h3 data-i18n="rep_empty_title">No hay reparaciones</h3>
                        <p data-i18n="rep_empty_subtitle">A√±ade una nueva reparaci√≥n para comenzar</p>
                    </div>
                </div>
            </div>

            <!-- Facturas View -->
            <div class="view" id="view-facturas">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="inv_title">Facturas</h1>
                    <div class="header-actions">
                        <div class="search-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" id="search-facturas" autocomplete="off"
                                placeholder="Buscar factura..." data-i18n-placeholder="inv_search_placeholder">
                        </div>
                        <div class="view-mode-toggle">
                            <button class="btn-icon mode-list" title="Lista" data-i18n-title="title_list">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="btn-icon mode-small" title="Mosaico Peque√±o"
                                data-i18n-title="title_mosaic_small">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="btn-icon mode-large active" title="Mosaico Grande"
                                data-i18n-title="title_mosaic_large">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="btn-add-factura"
                            ontouchstart="if(window.invoicesUI) window.invoicesUI.openModal();"
                            onclick="if(window.invoicesUI) window.invoicesUI.openModal(); else console.error('InvoicesUI not ready');">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span data-i18n="inv_btn_new">Nueva Factura</span>
                        </button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="cards-grid" id="facturas-grid">
                        <!-- Facturas se cargan aqu√≠ -->
                    </div>
                    <div class="empty-state" id="empty-facturas" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        <h3 data-i18n="inv_empty_title">No hay facturas</h3>
                    </div>
                </div>
            </div>

            <!-- Inventory View -->
            <div class="view" id="view-inventory">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="stk_title">Inventario</h1>
                    <div class="header-actions">
                        <div class="search-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="M21 21l-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" id="search-inventory" autocomplete="off"
                                placeholder="Buscar producto, SKU..." data-i18n-placeholder="stk_search_placeholder">
                        </div>
                        <div class="view-mode-toggle">
                            <button class="btn-icon mode-list" title="Lista" data-i18n-title="title_list"
                                onclick="if(window.inventoryUI) window.inventoryUI.setViewMode('list')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6"></line>
                                    <line x1="8" y1="12" x2="21" y2="12"></line>
                                    <line x1="8" y1="18" x2="21" y2="18"></line>
                                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                                </svg>
                            </button>
                            <button class="btn-icon mode-small" title="Mosaico Peque√±o"
                                data-i18n-title="title_mosaic_small"
                                onclick="if(window.inventoryUI) window.inventoryUI.setViewMode('small')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </button>
                            <button class="btn-icon mode-large active" title="Mosaico Grande"
                                data-i18n-title="title_mosaic_large"
                                onclick="if(window.inventoryUI) window.inventoryUI.setViewMode('large')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="btn-add-product"
                            onclick="if(window.inventoryUI) window.inventoryUI.openModal()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span data-i18n="stk_btn_new">Nuevo Producto</span>
                        </button>
                    </div>
                </header>
                <div class="content-body">
                    <div class="cards-grid inventory-grid" id="inventory-grid">
                        <!-- Products will be loaded here -->
                    </div>
                    <div class="empty-state" id="empty-inventory" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
                            </path>
                        </svg>
                        <h3 data-i18n="stk_empty_title">No hay productos</h3>
                        <p data-i18n="stk_empty_subtitle">A√±ade tu primer producto al inventario</p>
                    </div>
                </div>
            </div>

            <!-- Citas View -->
            <div class="view" id="view-citas">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="citas_title">Calendario de Citas</h1>
                    <div class="header-actions">
                        <div class="view-mode-toggle">
                            <button class="btn-icon" id="prev-month" title="Mes Anterior">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="15 18 9 12 15 6"></polyline>
                                </svg>
                            </button>
                            <span id="calendar-month-year"
                                style="font-weight: 600; min-width: 120px; text-align: center;">...</span>
                            <button class="btn-icon" id="next-month" title="Mes Siguiente">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 18 15 12 9 6"></polyline>
                                </svg>
                            </button>
                            <button class="btn-icon" id="today-btn" title="Hoy">
                                <span style="font-size: 0.8rem;">Hoy</span>
                            </button>
                        </div>
                        <button class="btn btn-primary" id="btn-add-cita">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            <span data-i18n="citas_btn_new">Nueva Cita</span>
                        </button>
                    </div>
                </header>
                <div class="content-body" style="overflow: hidden;">
                    <div class="calendar-container">
                        <div class="calendar-main">
                            <div class="calendar-grid" id="calendar-grid">
                                <!-- Calendar Generated by JS -->
                            </div>
                        </div>
                        <div class="calendar-sidebar">
                            <h3 style="font-size: 1.1rem; margin-bottom: 15px;">Pr√≥ximas Citas</h3>
                            <div class="upcoming-list" id="upcoming-citas-list">
                                <!-- List Generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- POS View (Caja) -->
            <div class="view" id="view-pos">
                <header class="content-header">
                    <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <button id="btn-pos-back" class="btn-icon"
                                style="display: none; border-radius: 50%; background: var(--bg-card); border: 1px solid var(--border-color); margin-right: 5px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="19" y1="12" x2="5" y2="12"></line>
                                    <polyline points="12 19 5 12 12 5"></polyline>
                                </svg>
                            </button>
                            <h1 class="page-title" id="pos-header-title">Caja / TPV</h1>
                            <span id="pos-shift-status" class="status-badge"
                                style="background: rgba(255, 255, 255, 0.1); color: var(--text-secondary);">Cerrada</span>
                        </div>
                    </div>
                </header>

                <div class="content-body" style="padding: 0; overflow: hidden; display: flex; height: 100%;">
                    <!-- Left: Products Grid -->
                    <div class="pos-products-area"
                        style="flex: 1; padding: var(--spacing-lg); overflow-y: auto; border-right: 1px solid var(--border-color);">

                        <!-- Search & Filter -->
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <div class="search-container" style="flex: 1;">
                                <svg xmlns="http://www.w3.org/2000/svg" class="search-icon" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                <input type="text" id="pos-search" class="search-input"
                                    placeholder="Buscar producto (Nombre, SKU)..." autocomplete="off">
                            </div>
                            <select id="pos-category-filter" class="form-select" style="width: 150px;">
                                <option value="">Todas</option>
                            </select>
                        </div>

                        <!-- Grid -->
                        <div id="pos-products-grid"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px;">
                            <!-- Products injected here -->
                        </div>
                    </div>

                    <!-- Right: Cart & Actions -->
                    <div class="pos-cart-area"
                        style="width: 350px; background: var(--bg-secondary); display: flex; flex-direction: column; height: 100%;">

                        <!-- Cart Header -->
                        <div
                            style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0;">Ticket Actual</h3>
                            <button id="btn-pos-clear" class="btn btn-sm"
                                style="color: var(--danger); background: rgba(255, 71, 87, 0.1);">
                                üóëÔ∏è Limpiar
                            </button>
                        </div>

                        <!-- Cart Items -->
                        <div id="pos-cart-items" style="flex: 1; overflow-y: auto; padding: 10px;">
                            <!-- Items injected here -->
                            <div id="pos-empty-cart"
                                style="text-align: center; color: var(--text-muted); padding-top: 50px;">
                                <p>Rejilla vac√≠a</p>
                            </div>
                        </div>

                        <!-- Cart Footer (Totals & Pay) -->
                        <div
                            style="padding: 20px; background: var(--bg-card); border-top: 1px solid var(--border-color);">
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; color: var(--text-secondary);">
                                <span>Subtotal</span>
                                <span id="pos-total-subtotal">0.00 ‚Ç¨</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.9rem; color: var(--text-secondary);">
                                <span>Impuestos</span>
                                <span id="pos-total-tax">0.00 ‚Ç¨</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 1.5rem; font-weight: bold; color: var(--electric-cyan);">
                                <span>TOTAL</span>
                                <span id="pos-total-total">0.00 ‚Ç¨</span>
                            </div>

                            <button id="btn-pos-pay" class="btn btn-primary"
                                style="width: 100%; padding: 15px; font-size: 1.1rem; justify-content: center;">
                                üí≥ Cobrar / Finalizar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MODAL COBRO POS -->
            <div class="modal-overlay" id="modal-pos-pay">
                <div class="modal" style="max-width: 400px;">
                    <div class="modal-header">
                        <h2 class="modal-title">Finalizar Venta</h2>
                        <button class="modal-close" data-close-modal="modal-pos-pay">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <p style="color: var(--text-secondary); margin-bottom: 5px;">Total a Pagar</p>
                            <h1 id="pos-pay-total" style="font-size: 2.5rem; color: var(--electric-cyan); margin: 0;">
                                0.00 ‚Ç¨</h1>
                        </div>

                        <div class="form-group">
                            <label class="form-label">M√©todo de Pago</label>
                            <div class="segmented-control" style="margin-bottom: 15px;">
                                <button type="button" class="segmented-option active" data-method="cash"
                                    id="btn-pay-cash">
                                    <span>üíµ Efectivo</span>
                                </button>
                                <button type="button" class="segmented-option" data-method="card" id="btn-pay-card">
                                    <span>üí≥ Tarjeta</span>
                                </button>
                            </div>
                        </div>

                        <div id="pos-cash-container">
                            <div class="form-group">
                                <label class="form-label">Entregado</label>
                                <input type="text" inputmode="decimal" id="pos-pay-amount" class="form-input"
                                    style="font-size: 1.2rem; text-align: center;" placeholder="0,00">
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                                <span style="font-weight: bold;">Cambio:</span>
                                <span id="pos-pay-change"
                                    style="font-weight: bold; color: var(--status-completed);">0.00 ‚Ç¨</span>
                            </div>
                        </div>

                        <!-- Client Selection Optional -->
                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label">Cliente (Opcional)</label>
                            <select id="pos-client-select" class="form-select" style="width: 100%;">
                                <option value="">Cliente General / Contado</option>
                            </select>
                        </div>

                        <div id="pos-success-container" style="display: none; text-align: center; padding: 20px;">
                            <div style="font-size: 3rem; margin-bottom: 10px;">‚úÖ</div>
                            <h3 style="color: var(--text-primary); margin-bottom: 20px;" data-i18n="pos_sale_success">
                                Venta Finalizada</h3>

                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button id="btn-pos-print-last" class="btn btn-primary full-width"
                                    style="background: var(--electric-cyan); color: #000;">
                                    <i class="fas fa-print"></i> <span data-i18n="pos_print_ticket">Imprimir
                                        Ticket</span>
                                </button>
                                <button id="btn-pos-new-sale" class="btn btn-secondary full-width">
                                    <i class="fas fa-plus"></i> <span data-i18n="pos_new_sale">Nueva Venta</span>
                                </button>
                            </div>
                        </div>

                        <div class="modal-buttons" id="pos-pay-actions">
                            <button class="btn btn-secondary"
                                onclick="document.getElementById('modal-pos-pay').classList.remove('active')">Cancelar</button>
                            <button class="btn btn-primary" onclick="window.posUI.finalizeSale()">Confirmar
                                Venta</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div class="view" id="view-settings">
                <header class="content-header">
                    <h1 class="page-title" data-i18n="nav_ajustes">Ajustes y Seguridad</h1>
                </header>
                <div class="content-body" style="width: 100%; max-width: none; margin: 0; padding: 0;">

                    <!-- CONFIGURACI√ìN -->
                    <style>
                        /* Estilos Pesta√±as Pro */
                        .settings-tabs {
                            display: flex;
                            gap: var(--spacing-sm);
                            margin-bottom: var(--spacing-md);
                            background: var(--bg-secondary);
                            padding: 4px;
                            border-radius: 12px;
                            border: 1px solid var(--border-color);
                            overflow-x: auto;
                        }

                        .settings-tab-btn {
                            flex: 1;
                            padding: 10px 16px;
                            border: none;
                            background: transparent;
                            color: var(--text-secondary);
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 500;
                            transition: all 0.2s ease;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 8px;
                            white-space: nowrap;
                        }

                        .settings-tab-btn:hover {
                            background: rgba(255, 255, 255, 0.05);
                            color: var(--text-primary);
                        }

                        /* WhatsApp Template Textareas */
                        #form-templates textarea {
                            min-height: 180px;
                            font-family: var(--font-mono, 'Consolas', 'Monaco', monospace) !important;
                            line-height: 1.6;
                            padding: 15px;
                            resize: vertical;
                            font-size: 0.95rem;
                        }

                        .settings-tab-btn.active {
                            background: var(--bg-primary);
                            color: var(--accent-color);
                            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        }

                        .settings-tab-content {
                            display: none;
                            animation: fadeIn 0.3s ease;
                        }

                        .settings-tab-content.active {
                            display: flex;
                            flex-direction: column;
                            gap: var(--spacing-md);
                        }

                        @keyframes fadeIn {
                            from {
                                opacity: 0;
                                transform: translateY(10px);
                            }

                            to {
                                opacity: 1;
                                transform: translateY(0);
                            }
                        }
                    </style>

                    <!-- Men√∫ de Pesta√±as -->
                    <div class="settings-tabs">
                        <button class="settings-tab-btn active" data-tab="tab-empresa"
                            onclick="window.settingsUI.switchTab('tab-empresa')">
                            üè¢ <span data-i18n="set_tab_company">Empresa</span>
                        </button>
                        <button class="settings-tab-btn" data-tab="tab-plantillas"
                            onclick="window.settingsUI.switchTab('tab-plantillas')">
                            üí¨ <span data-i18n="set_tab_templates">Plantillas WhatsApp</span>
                        </button>
                        <button class="settings-tab-btn" data-tab="tab-security"
                            onclick="window.settingsUI.switchTab('tab-security')">
                            üõ°Ô∏è <span data-i18n="set_tab_security">Seguridad y Staff</span>
                        </button>
                        <button class="settings-tab-btn" data-tab="tab-backup"
                            onclick="window.settingsUI.switchTab('tab-backup')">
                            üíæ <span data-i18n="set_tab_backup">Copias de Seguridad</span>
                        </button>
                        <button class="settings-tab-btn" data-tab="tab-help"
                            onclick="window.settingsUI.switchTab('tab-help')">
                            üìñ <span data-i18n="set_tab_help">Ayuda y FAQ</span>
                        </button>
                    </div>

                    <!-- CONTENIDO PESTA√ëAS -->

                    <!-- TAB 1: EMPRESA -->
                    <div id="tab-empresa" class="settings-tab-content active">
                        <!-- Tema -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_theme_title">Tema Visual</h3>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="segmented-control">
                                    <button type="button" class="segmented-option active" id="btn-theme-dark"
                                        onclick="app.setTheme('dark')">
                                        <span class="icon">üåô</span>
                                        <span data-i18n="set_theme_dark">Oscuro</span>
                                    </button>
                                    <button type="button" class="segmented-option" id="btn-theme-light"
                                        onclick="app.setTheme('light')">
                                        <span class="icon">‚òÄÔ∏è</span>
                                        <span data-i18n="set_theme_light">Claro</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Idioma -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="settings_language">Idioma de la aplicaci√≥n</h3>
                                </div>
                            </div>
                            <div class="card-body">
                                <select id="app-language-selector" class="form-select"
                                    onchange="i18n.setLocale(this.value)">
                                    <option value="es" data-i18n="lang_es">Espa√±ol</option>
                                    <option value="en" data-i18n="lang_en">Ingl√©s</option>
                                    <option value="fr" data-i18n="lang_fr">Franc√©s</option>
                                    <option value="pt" data-i18n="lang_pt">Portugu√©s</option>
                                </select>
                            </div>
                        </div>

                        <!-- Logo Upload -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_company_logo_title">Logo de Empresa</h3>
                                    <p class="card-subtitle" data-i18n="set_company_logo_subtitle">Personaliza tu marca
                                    </p>
                                </div>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                                    <div style="width: 80px; height: 80px; background: var(--bg-primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 2px dashed var(--border-color); overflow: hidden; position: relative;"
                                        id="logo-preview-container">
                                        <span style="font-size: 2rem; color: var(--text-secondary);">üì∑</span>
                                        <img id="logo-preview" src="" alt="Logo"
                                            style="width: 100%; height: 100%; object-fit: contain; display: none;">
                                    </div>
                                    <div style="flex: 1;">
                                        <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;"
                                            data-i18n="set_company_logo_help">
                                            Sube tu logo (PNG/JPG). Se usar√° en facturas.
                                        </p>
                                        <div style="display: flex; gap: 8px; justify-content: center;">
                                            <input type="file" id="logo-input" accept="image/*" style="display: none;">
                                            <button class="btn btn-secondary btn-sm" id="btn-upload-logo"
                                                data-i18n="set_company_btn_upload"
                                                style="display: flex; align-items: center; justify-content: center;">
                                                Subir Logo
                                            </button>
                                            <button class="btn btn-danger btn-sm" id="btn-delete-logo"
                                                style="display: none; align-items: center; justify-content: center;"
                                                data-i18n="set_company_btn_delete">
                                                Eliminar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Datos Empresa -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_fiscal_data_title">Datos Fiscales</h3>
                                    <p class="card-subtitle" data-i18n="set_fiscal_data_subtitle">Informaci√≥n para
                                        facturas
                                    </p>
                                </div>
                            </div>
                            <div class="card-body">
                                <form id="form-company-data">
                                    <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                        <label class="form-label" style="font-size: 0.85rem;"
                                            data-i18n="set_field_name">Nombre / Raz√≥n
                                            Social</label>
                                        <input type="text" class="form-input" id="company-name"
                                            placeholder="Mi Empresa S.L."
                                            data-i18n-placeholder="set_field_name_placeholder" style="padding: 8px;">
                                    </div>
                                    <div
                                        style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label" style="font-size: 0.85rem;"
                                                data-i18n="set_field_nif">NIF / CIF</label>
                                            <input type="text" class="form-input" id="company-dni"
                                                placeholder="B12345678"
                                                data-i18n-placeholder="set_field_nif_placeholder" style="padding: 8px;">
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label" style="font-size: 0.85rem;"
                                                data-i18n="set_field_phone">Tel√©fono</label>
                                            <input type="tel" class="form-input" id="company-phone"
                                                placeholder="+34 600..."
                                                data-i18n-placeholder="set_field_phone_placeholder"
                                                style="padding: 8px;">
                                        </div>
                                    </div>
                                    <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                        <label class="form-label" style="font-size: 0.85rem;"
                                            data-i18n="set_field_address">Direcci√≥n</label>
                                        <input type="text" class="form-input" id="company-address"
                                            placeholder="C/ Ejemplo..."
                                            data-i18n-placeholder="set_field_address_placeholder" style="padding: 8px;">
                                    </div>
                                    <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                        <label class="form-label" style="font-size: 0.85rem;"
                                            data-i18n="set_field_email">Email</label>
                                        <input type="email" class="form-input" id="company-email"
                                            placeholder="contacto@..."
                                            data-i18n-placeholder="set_field_email_placeholder" style="padding: 8px;">
                                    </div>

                                    <!-- Sistema de Impuestos (Segmentado: Espa√±a vs Internacional) -->
                                    <div
                                        style="margin-top: 20px; padding-top: 15px; border-top: 1px dashed var(--border-color);">
                                        <h4 style="font-size: 0.9rem; margin-bottom: 15px; color: var(--accent-color);"
                                            data-i18n="set_accounting_config_title">Sistema de impuestos</h4>

                                        <!-- Segmented Control Switches -->
                                        <div class="segmented-control">
                                            <button type="button" class="segmented-option active" id="btn-mode-spain"
                                                onclick="window.settingsUI.handleAccountingModeChange('spain')">
                                                <span class="icon">üá™üá∏</span>
                                                <span data-i18n="set_acc_mode_spain">Espa√±a</span>
                                            </button>
                                            <button type="button" class="segmented-option" id="btn-mode-intl"
                                                onclick="window.settingsUI.handleAccountingModeChange('international')">
                                                <span class="icon">üåê</span>
                                                <span data-i18n="set_acc_mode_intl">Internacional</span>
                                            </button>
                                        </div>

                                        <!-- Hidden input to store state -->
                                        <input type="hidden" id="company-accounting-mode" value="spain">

                                        <!-- Spain Config Block -->
                                        <div id="spain-tax-config">
                                            <div
                                                style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); margin-bottom: var(--spacing-sm);">
                                                <div class="form-group" style="margin-bottom: 0;">
                                                    <label class="form-label" style="font-size: 0.85rem;"
                                                        data-i18n="set_field_entity_type">Tipo de Entidad</label>
                                                    <select class="form-select" id="company-tax-entity"
                                                        style="padding: 8px;"
                                                        onchange="window.settingsUI.handleEntityChange(this.value)">
                                                        <option value="autonomo" data-i18n="set_tax_entity_autonomo">
                                                            Aut√≥nomo (Estimaci√≥n Directa)</option>
                                                        <option value="sociedad" data-i18n="set_tax_entity_sociedad">
                                                            Empresa (S.L.)</option>
                                                    </select>
                                                </div>
                                                <div class="form-group" style="margin-bottom: 0;">
                                                    <label class="form-label" style="font-size: 0.85rem;"
                                                        data-i18n="set_field_tax_iva">IVA Aplicable (%)</label>
                                                    <select id="company-tax-iva" class="form-input"
                                                        style="padding: 8px;">
                                                        <option value="21" data-i18n="set_tax_iva_gen">21% (General)
                                                        </option>
                                                        <option value="10" data-i18n="set_tax_iva_red">10% (Reducido)
                                                        </option>
                                                        <option value="4" data-i18n="set_tax_iva_sup">4% (Superreducido)
                                                        </option>
                                                        <option value="0" data-i18n="set_tax_iva_exe">0% (Exento)
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group" style="margin-bottom: 0;">
                                                <label class="form-label" id="label-tax-irpf"
                                                    style="font-size: 0.85rem;" data-i18n="set_field_tax_irpf">IRPF
                                                    (Retenci√≥n / Pagos)</label>
                                                <select id="company-tax-irpf" class="form-input" style="padding: 8px;">
                                                    <option value="0" data-i18n="set_tax_irpf_none">0% (Sin Retenci√≥n)
                                                    </option>
                                                    <option value="15" data-i18n="set_tax_irpf_gen">15% (General
                                                        Aut√≥nomos)</option>
                                                    <option value="7" data-i18n="set_tax_irpf_new">7% (Nuevos Aut√≥nomos)
                                                    </option>
                                                    <option value="1" data-i18n="set_tax_irpf_mod">1% (M√≥dulos)</option>
                                                    <option value="25" data-i18n="set_tax_irpf_corp">25% (Impuesto
                                                        Sociedades)</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- International Config Block -->
                                        <div id="intl-tax-config"
                                            style="display: none; background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; border: 1px solid var(--border-color);">
                                            <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                                <label class="form-label" style="font-size: 0.85rem;"
                                                    data-i18n="set_field_tax_label">Nombre del Impuesto (ej: IVA, VAT,
                                                    GST)</label>
                                                <input type="text" class="form-input" id="intl-tax-label"
                                                    placeholder="Impuesto" style="padding: 8px;">
                                            </div>
                                            <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                                <label class="form-label" style="font-size: 0.85rem;"
                                                    data-i18n="set_field_tax_rates">Tasas de Impuesto (% separadas por
                                                    comas)</label>
                                                <input type="text" class="form-input" id="intl-tax-rates"
                                                    placeholder="21, 10, 4, 0" style="padding: 8px;">
                                            </div>
                                            <div class="form-group" style="margin-bottom: var(--spacing-sm);">
                                                <label class="form-label" style="font-size: 0.85rem;"
                                                    data-i18n="set_field_ret_label">Nombre de Retenci√≥n (ej: IRPF,
                                                    Withholding)</label>
                                                <input type="text" class="form-input" id="intl-ret-label"
                                                    placeholder="Retenci√≥n" style="padding: 8px;">
                                            </div>
                                            <div class="form-group" style="margin-bottom: 0;">
                                                <label class="form-label" style="font-size: 0.85rem;"
                                                    data-i18n="set_field_ret_rates">Tasas de Retenci√≥n (% separadas por
                                                    comas)</label>
                                                <input type="text" class="form-input" id="intl-ret-rates"
                                                    placeholder="15, 7, 0" style="padding: 8px;">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group" style="margin-top: 15px; margin-bottom: var(--spacing-sm);">
                                        <label class="form-label" style="font-size: 0.85rem;"
                                            data-i18n="set_field_currency">Moneda del Negocio</label>
                                        <select id="company-currency" class="form-select" style="padding: 8px;">
                                            <option value="EUR" data-i18n="set_curr_eur">Euro (‚Ç¨)</option>
                                            <option value="USD" data-i18n="set_curr_usd">D√≥lar ($)</option>
                                            <option value="GBP" data-i18n="set_curr_gbp">Libra (¬£)</option>
                                            <option value="MXN" data-i18n="set_curr_mxn">Peso Mexicano (MXN)</option>
                                            <option value="BRL" data-i18n="set_curr_brl">Real Brasile√±o (R$)</option>
                                            <option value="CLP" data-i18n="set_curr_clp">Peso Chileno (CLP)</option>
                                            <option value="COP" data-i18n="set_curr_cop">Peso Colombiano (COP)</option>
                                            <option value="ARS" data-i18n="set_curr_ars">Peso Argentino (ARS)</option>
                                            <option value="PEN" data-i18n="set_curr_pen">Sol Peruano (PEN)</option>
                                            <option value="UYU" data-i18n="set_curr_uyu">Peso Uruguayo (UYU)</option>
                                        </select>
                                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px;"
                                            data-i18n="set_field_currency_help">Selecciona la moneda para tus precios.
                                        </p>
                                    </div>

                                    <div style="text-align: center;">
                                        <button type="submit" class="btn btn-primary btn-sm" id="btn-save-company"
                                            style="display: flex; align-items: center; justify-content: center; width: 100%; max-width: 300px; margin: 0 auto;"
                                            data-i18n="set_btn_save">Guardar
                                            Datos</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Configuraci√≥n de Seguimiento (Tracking URL) -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_tracking_title">Configuraci√≥n de Seguimiento
                                    </h3>
                                    <p class="card-subtitle" data-i18n="set_tracking_subtitle">Enlace p√∫blico para
                                        clientes</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="set_tracking_url_label">URL de Seguimiento
                                        (Tracking)</label>
                                    <input type="url" class="form-input" id="company-tracking-url"
                                        placeholder="https://david1932.github.io/reparapp/tracking.html"
                                        data-i18n-placeholder="set_tracking_url_placeholder">
                                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px;"
                                        data-i18n="set_tracking_url_help">
                                        Esta es la URL que se enviar√° a los clientes para consultar el estado.
                                        Si usas la app en local, puedes poner
                                        <code>http://localhost:3000/tracking.html</code> o dejarlo vac√≠o para desactivar
                                        el enlace.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: PLANTILLAS (NUEVO) -->
                    <div id="tab-plantillas" class="settings-tab-content">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title" data-i18n="set_tpl_title">Plantillas de Mensajes (WhatsApp)</h2>
                            </div>
                            <div class="card-body">
                                <p style="margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.9rem;">
                                    <span data-i18n="set_tpl_help">Personaliza los mensajes que se env√≠an
                                        autom√°ticamente al cliente.
                                        Usa estas variables:</span>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{CLIENTE}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{DISPOSITIVO}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{PRECIO}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{URL}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{IMEI}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{REPUESTOS}</code>
                                    <code
                                        style="background:var(--bg-primary); padding:2px 4px; border-radius:4px;">{CHECKLIST}</code>
                                </p>

                                <form id="form-templates">
                                    <div class="form-group">
                                        <label class="form-label" data-i18n="set_tpl_label_pending">Estado: Recibido /
                                            Pendiente</label>
                                        <textarea id="tpl-pendiente" class="form-input" rows="6"
                                            placeholder="Hola {CLIENTE}, hemos recibido tu {DISPOSITIVO}..."
                                            data-i18n-placeholder="set_tpl_pending_placeholder"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" data-i18n="set_tpl_label_budget">Estado: Presupuesto
                                            Disponible</label>
                                        <textarea id="tpl-presupuesto" class="form-input" rows="6"
                                            placeholder="Hola {CLIENTE}, ya tenemos el presupuesto..."
                                            data-i18n-placeholder="set_tpl_budget_placeholder"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" data-i18n="set_tpl_label_ready">Estado: Reparado /
                                            Listo</label>
                                        <textarea id="tpl-reparado" class="form-input" rows="6"
                                            style="border-color: var(--status-completed);"
                                            placeholder="Hola {CLIENTE}, tu equipo est√° listo..."
                                            data-i18n-placeholder="set_tpl_ready_placeholder"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" data-i18n="set_tpl_label_delivered">Estado:
                                            Entregado</label>
                                        <textarea id="tpl-entregado" class="form-input" rows="6"
                                            placeholder="Gracias por confiar en nosotros..."
                                            data-i18n-placeholder="set_tpl_delivered_placeholder"></textarea>
                                    </div>

                                    <div class="form-actions">
                                        <button type="submit" class="btn btn-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path
                                                    d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v13a2 2 0 0 1-2 2z">
                                                </path>
                                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                                <polyline points="7 3 7 8 15 8"></polyline>
                                            </svg>
                                            <span data-i18n="set_btn_save_tpl">Guardar Plantillas</span>
                                        </button>
                                        <button type="button" class="btn btn-secondary" id="btn-reset-templates"
                                            style="display: flex; align-items: center; justify-content: center; gap: 8px;"
                                            title="Restaurar valores por defecto" data-i18n-title="title_restore">
                                            <span data-i18n="set_btn_restore_tpl">Restaurar</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 2: SINCRONIZACI√ìN -->
                    <div id="tab-backup" class="settings-tab-content">
                        <!-- Carpeta Local -->
                        <!-- Copias Locales Autom√°ticas -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_backup_auto_title">Copias Locales Autom√°ticas
                                    </h3>
                                    <p class="card-subtitle" data-i18n="set_backup_auto_subtitle">Sincronizaci√≥n PC</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <p style="color: var(--text-secondary); margin-bottom: 10px; font-size: 0.85rem;">
                                    <span data-i18n="set_backup_auto_help">Selecciona una carpeta para guardar copias
                                        autom√°ticamente al cerrar la app.</span>
                                </p>

                                <div class="setting-item" style="border: none; padding: 0;">
                                    <div style="display: flex; flex-direction: column; gap: 10px; width: 100%;">
                                        <div id="auto-backup-status"
                                            style="display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: var(--status-rejected); background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; border: 1px solid var(--border-color);">
                                            <span
                                                style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: currentColor;"></span>
                                            <span data-i18n="set_backup_status_none">Sin configurar</span>
                                        </div>
                                        <button class="btn btn-primary" id="btn-setup-autobackup"
                                            data-i18n="set_backup_btn_setup"
                                            style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; background: var(--gradient-primary); color: white; font-weight: bold; border: none;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path
                                                    d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
                                                </path>
                                            </svg>
                                            Guardar Copia
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Copias de Seguridad (Importar/Exportar) -->
                        <div class="card">
                            <div class="card-header" style="margin-bottom: var(--spacing-sm);">
                                <div
                                    style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                                    <div>
                                        <h3 class="card-title" data-i18n="set_tab_backup">Backups</h3>
                                    </div>
                                    <div title="Importar sobrescribe datos" data-i18n-title="set_backup_warn_overwrite"
                                        style="cursor:help;">‚ö†Ô∏è</div>
                                </div>
                            </div>
                            <div class="card-body" style="margin-bottom: 0;">
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm);">
                                    <!-- Exportar -->
                                    <div style="display: flex; flex-direction: column; gap: 4px;">
                                        <span
                                            style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px;"
                                            data-i18n="ges_movements">Exportar</span>
                                        <button class="btn btn-secondary btn-sm" id="btn-export-backup"
                                            title="Formato PC Nativo" data-i18n-title="set_backup_pc_format"
                                            style="justify-content: center; background: linear-gradient(135deg, rgba(0, 120, 215, 0.25), rgba(0, 168, 243, 0.2)); border: 1px solid rgba(0, 168, 243, 0.5); color: #00a8f3; font-weight: 600;">
                                            <svg width="16" height="16" viewBox="0 0 88 88"
                                                style="margin-right: 6px; vertical-align: middle;">
                                                <path fill="#00adef"
                                                    d="M0 12.5l35.7-4.9v34.5H0zM40 6.9l47.5-6.5v43.2H40zM87.5 48.3v43.2L40 84.6V48.3zM35.7 80.9L0 76v-28h35.7z" />
                                            </svg>
                                            <span data-i18n="set_backup_pc_title">PC Nativo</span>
                                        </button>
                                        <button class="btn btn-primary btn-sm" id="btn-export-universal"
                                            title="Compatible con Android (ReparApp)"
                                            data-i18n-title="set_backup_android_compat"
                                            style="justify-content: center; background: #28a745; border-color: #28a745;">
                                            <span data-i18n="set_backup_android_title">ANDROID / UNIVERSAL
                                                (Recomendado)</span>
                                        </button>
                                    </div>
                                    <!-- Importar -->
                                    <div style="display: flex; flex-direction: column; gap: 4px;">
                                        <span
                                            style="font-size: 0.75rem; color: var(--status-in-progress); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 2px;"
                                            data-i18n="ges_btn_sync_income">Importar</span>
                                        <input type="file" id="backup-input-json" accept=".json" style="display: none;">
                                        <button class="btn btn-secondary btn-sm"
                                            onclick="document.getElementById('backup-input-json').click()"
                                            title="Importar JSON" data-i18n-title="set_backup_import_json_title"
                                            style="justify-content: center; background: rgba(255, 255, 255, 0.95); border: 1px solid #e5e7eb; color: #1f2937; font-weight: 700;">
                                            <svg width="18" height="18" viewBox="0 0 24 28"
                                                style="margin-right: 6px; vertical-align: middle;">
                                                <!-- Document outline with folded corner -->
                                                <path d="M2 2h14l6 6v18H2z" fill="white" stroke="#1f2937"
                                                    stroke-width="1.5" />
                                                <path d="M16 2v6h6" fill="none" stroke="#1f2937" stroke-width="1.5" />
                                                <!-- Curly braces with colon { : } -->
                                                <text x="5" y="18" font-family="Arial, sans-serif" font-size="9"
                                                    font-weight="bold" fill="#1f2937">{:}</text>
                                            </svg>
                                            <span data-i18n="set_backup_import_json">JSON</span>
                                        </button>
                                        <input type="file" id="backup-input-zip" accept=".zip" style="display: none;">
                                        <button class="btn btn-secondary btn-sm"
                                            onclick="document.getElementById('backup-input-zip').click()"
                                            title="Importar ZIP" data-i18n-title="set_backup_import_zip_title"
                                            style="justify-content: center; background: linear-gradient(135deg, rgba(139, 92, 246, 0.25), rgba(168, 85, 247, 0.2)); border: 1px solid rgba(139, 92, 246, 0.5); color: #a78bfa; font-weight: 600;">
                                            <svg width="18" height="18" viewBox="0 0 24 24"
                                                style="margin-right: 6px; vertical-align: middle;">
                                                <!-- Yellow file cabinet -->
                                                <rect x="3" y="3" width="12" height="18" rx="1" fill="#d4a017"
                                                    stroke="#8b6914" stroke-width="0.5" />
                                                <!-- Top drawer -->
                                                <rect x="4" y="4" width="10" height="7" fill="#f0c030" stroke="#8b6914"
                                                    stroke-width="0.5" />
                                                <rect x="6" y="6" width="6" height="2" fill="white" rx="0.5" />
                                                <!-- Bottom drawer -->
                                                <rect x="4" y="12" width="10" height="7" fill="#f0c030" stroke="#8b6914"
                                                    stroke-width="0.5" />
                                                <rect x="6" y="14" width="6" height="2" fill="white" rx="0.5" />
                                                <!-- Grey clamp/zipper -->
                                                <rect x="14" y="5" width="3" height="14" fill="#6b7280" />
                                                <rect x="16" y="3" width="5" height="4" rx="1" fill="#9ca3af" />
                                                <rect x="16" y="17" width="5" height="4" rx="1" fill="#9ca3af" />
                                                <!-- Zipper teeth -->
                                                <line x1="17" y1="8" x2="19" y2="8" stroke="#4b5563" stroke-width="1" />
                                                <line x1="17" y1="10" x2="19" y2="10" stroke="#4b5563"
                                                    stroke-width="1" />
                                                <line x1="17" y1="12" x2="19" y2="12" stroke="#4b5563"
                                                    stroke-width="1" />
                                                <line x1="17" y1="14" x2="19" y2="14" stroke="#4b5563"
                                                    stroke-width="1" />
                                                <line x1="17" y1="16" x2="19" y2="16" stroke="#4b5563"
                                                    stroke-width="1" />
                                            </svg>
                                            <span data-i18n="set_backup_import_zip">ZIP</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Google Drive -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_drive_title">Google Drive</h3>
                                    <p class="card-subtitle" data-i18n="set_drive_subtitle">Copia en la nube</p>
                                </div>
                                <div>‚òÅÔ∏è</div>
                            </div>
                            <div class="card-body">
                                <div id="cloud-sync-status"
                                    style="margin-bottom: var(--spacing-sm); padding: var(--spacing-sm); border-radius: 8px; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between;">
                                    <span id="drive-status-text"
                                        style="font-weight: bold; font-size: 0.8rem; color: var(--text-secondary);"
                                        data-i18n="set_drive_status_unknown">Estado
                                        Desconocido</span>
                                </div>

                                <details
                                    style="margin-bottom: 12px; border-bottom: 1px dashed var(--border-color); padding-bottom: 12px;">
                                    <summary
                                        style="font-size: 0.75rem; color: var(--text-secondary); cursor: pointer; margin-bottom: 8px;"
                                        data-i18n="set_drive_advanced">
                                        ‚öôÔ∏è Configuraci√≥n Avanzada (Opcional)</summary>
                                    <label
                                        style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 4px;">Google
                                        Client ID (Personalizado)</label>
                                    <input type="text" id="drive-client-id" class="form-input"
                                        placeholder="Introduce tu Client ID para activar Drive..."
                                        style="font-size: 0.8rem; padding: 8px; width: 100%; background: var(--bg-primary);"
                                        onchange="if(window.db) db.setConfig('google_client_id', this.value).then(()=> { app.showToast('Client ID actualizado. Reinicia para aplicar.', 'info'); window.location.reload(); })">
                                    <p style="font-size: 0.7rem; color: var(--text-secondary); margin-top: 4px;"
                                        data-i18n="set_drive_client_id_help">Deja
                                        vac√≠o para usar la configuraci√≥n por defecto.</p>
                                </details>

                                <button class="btn btn-warning" id="btn-drive-connect"
                                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 12px; font-weight: 600;"
                                    onclick="window.settingsUI.handleConnectDrive()">
                                    <svg viewBox="0 0 87.3 78" width="20" height="20">
                                        <path
                                            d="m6.6 66.85 3.85 6.65c.8 1.4 1.95 2.5 3.3 3.3l13.75-23.8h-27.5c0 1.55.4 3.1 1.2 4.5z"
                                            fill="#0066da" stroke="#1f2937" stroke-width="1.5" />
                                        <path
                                            d="m43.65 25-13.75-23.8c-1.35.8-2.5 1.9-3.3 3.3l-25.4 44a9.06 9.06 0 0 0 -1.2 4.5h27.5z"
                                            fill="#00ac47" stroke="#1f2937" stroke-width="1.5" />
                                        <path
                                            d="m73.55 76.8c1.35-.8 2.5-1.9 3.3-3.3l1.6-2.75 7.65-13.25c.8-1.4 1.2-2.95 1.2-4.5h-27.502l5.852 11.5z"
                                            fill="#ea4335" stroke="#1f2937" stroke-width="1.5" />
                                        <path
                                            d="m43.65 25 13.75-23.8c-1.35-.8-2.9-1.2-4.5-1.2h-18.5c-1.6 0-3.15.45-4.5 1.2z"
                                            fill="#00832d" stroke="#1f2937" stroke-width="1.5" />
                                        <path
                                            d="m59.8 53h-32.3l-13.75 23.8c1.35.8 2.9 1.2 4.5 1.2h50.8c1.6 0 3.15-.45 4.5-1.2z"
                                            fill="#2684fc" stroke="#1f2937" stroke-width="1.5" />
                                        <path
                                            d="m73.4 26.5-12.7-22c-.8-1.4-1.95-2.5-3.3-3.3l-13.75 23.8 16.15 28h27.45c0-1.55-.4-3.1-1.2-4.5z"
                                            fill="#ffba00" stroke="#1f2937" stroke-width="1.5" />
                                    </svg>
                                    <span data-i18n="set_drive_btn_connect">Conectar Drive</span>
                                </button>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                    <button class="btn btn-secondary" id="btn-backup-drive"
                                        style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.15)); border-color: rgba(16, 185, 129, 0.4);"
                                        onclick="window.settingsUI.handleDriveBackup()">
                                        Guardar Copia
                                    </button>
                                    <button class="btn btn-secondary" id="btn-restore-drive"
                                        style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(217, 119, 6, 0.25)); color: #fcd34d; border: 1px solid rgba(245, 158, 11, 0.4); font-weight: 600;"
                                        onclick="window.settingsUI.handleDriveRestore()">
                                        <span data-i18n="set_drive_btn_restore">Restaurar</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Supabase -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_supabase_title">Supabase Cloud</h3>
                                    <p class="card-subtitle" data-i18n="set_supabase_subtitle">Sincronizaci√≥n Avanzada
                                    </p>
                                </div>
                                <div title="Sincronizaci√≥n multi-dispositivo en tiempo real"
                                    data-i18n-title="set_supabase_sync_title" style="cursor:help;">‚ö°
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="set_field_supabase_url">Supabase URL</label>
                                    <input type="text" class="form-input" id="supabase-url"
                                        placeholder="https://xyz.supabase.co">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="set_field_supabase_key">Supabase Key</label>
                                    <input type="password" class="form-input" id="supabase-key" placeholder="eyJ...">
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-primary" id="btn-save-supabase"
                                        style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;"
                                        onclick="window.manualSupabaseSave()">
                                        <span data-i18n="set_supabase_btn_save">Guardar</span>
                                    </button>
                                    <button class="btn btn-secondary" id="btn-test-supabase"
                                        style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;"
                                        onclick="window.manualSupabaseTest()">
                                        <span data-i18n="set_supabase_btn_test">Test</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 4: SEGURIDAD (Mantenimiento y PIN) -->
                    <div id="tab-security" class="settings-tab-content">
                        <!-- Mantenimiento -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_sec_maint_title">Mantenimiento</h3>
                                    <p class="card-subtitle" data-i18n="set_sec_maint_subtitle">Limpieza de datos</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <p style="margin-bottom: var(--spacing-md); font-size: 0.9rem;">
                                    <span data-i18n="set_sec_maint_help">Elimina clientes duplicados por Nombre o
                                        DNI.</span>
                                </p>
                                <button class="btn btn-secondary" id="btn-deduplicate"
                                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <span data-i18n="set_sec_btn_deduplicate">Eliminar Duplicados</span>
                                </button>
                            </div>
                        </div>

                        <!-- Gesti√≥n de Personal -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_sec_staff_title">Gesti√≥n de Personal</h3>
                                    <p class="card-subtitle" data-i18n="set_sec_staff_subtitle">Administrar accesos de
                                        Jefe
                                        y Empleados</p>
                                </div>
                            </div>
                            <div class="card-body">
                                <div
                                    style="display: flex; gap: 10px; align-items: flex-end; margin-bottom: 20px; flex-wrap: wrap;">
                                    <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 80px;">
                                        <label class="form-label" style="font-size: 0.75rem;"
                                            data-i18n="set_sec_staff_name">Nombre</label>
                                        <input type="text" id="staff-name" class="form-input" placeholder="Nombre">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 80px;">
                                        <label class="form-label" style="font-size: 0.75rem;"
                                            data-i18n="set_sec_staff_role">Rol</label>
                                        <select id="staff-role" class="form-input">
                                            <option value="admin">üëë Jefe</option>
                                            <option value="employee">üõ†Ô∏è T√©cnico
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 80px;">
                                        <label class="form-label" style="font-size: 0.75rem;"
                                            data-i18n="set_sec_staff_pin">PIN</label>
                                        <input type="password" id="staff-pin" class="form-input" placeholder="****"
                                            maxlength="4" style="text-align: center;">
                                    </div>
                                    <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 80px;">
                                        <label class="form-label" style="font-size: 0.75rem;">&nbsp;</label>
                                        <button class="btn btn-primary" id="btn-add-staff"
                                            onclick="window.settingsUI.handleAddStaff()"
                                            style="height: 40px; width: 100%; margin-bottom: 0; padding: 0; border-radius: var(--radius-md); font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                            <span data-i18n="set_sec_btn_create">CREAR</span>
                                        </button>
                                    </div>
                                </div>

                                <div id="staff-list-container"
                                    style="margin-top: 20px; max-height: 200px; overflow-y: auto; border-top: 1px solid var(--border-color); padding-top: 15px;">
                                    <!-- Usuarios din√°micos -->
                                </div>
                            </div>
                        </div>

                        <!-- Diagn√≥stico de Datos -->
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_sec_diag_title">Diagn√≥stico de Datos</h3>
                                    <p class="card-subtitle" data-i18n="set_sec_diag_subtitle">Reparar v√≠nculos rotos
                                    </p>
                                </div>
                            </div>
                            <div class="card-body">
                                <p style="margin-bottom: var(--spacing-md); font-size: 0.9rem; color: var(--text-secondary);"
                                    data-i18n="set_sec_diag_help">
                                    Herramienta de emergencia para reconectar reparaciones y facturas que han
                                    perdido a
                                    su cliente (hu√©rfanas).
                                </p>
                                <button id="btn-diagnose-data" class="btn btn-warning"
                                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;">
                                    <span style="font-size: 1.2rem;">ü©∫</span> <span
                                        data-i18n="set_sec_btn_diagnose">Diagnosticar y Reparar</span>
                                </button>
                            </div>
                        </div>

                        <!-- Danger Zone -->
                        <div class="card"
                            style="border: 1px solid rgba(255, 71, 87, 0.3); background: rgba(255, 71, 87, 0.05);">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" style="color: var(--status-error);"
                                        data-i18n="set_sec_danger_title">Zona
                                        de
                                        Peligro</h3>
                                    <p class="card-subtitle" data-i18n="set_sec_danger_subtitle">Acciones destructivas
                                    </p>
                                </div>
                            </div>
                            <div class="card-body">
                                <p style="margin-bottom: var(--spacing-md); font-size: 0.9rem; color: var(--text-secondary);"
                                    data-i18n="set_sec_danger_help">
                                    Esta acci√≥n eliminar√° permanentemente todos los
                                    clientes, reparaciones y facturas.
                                </p>
                                <button class="btn btn-danger" id="btn-clear-data"
                                    style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 10px;"
                                    onclick="if(window.settingsUI) window.settingsUI.handleClearData()">
                                    üóëÔ∏è <span data-i18n="set_sec_btn_clear">Borrar Todos los Datos</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB 5: AYUDA Y FAQ -->
                    <div id="tab-help" class="settings-tab-content">
                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_help_title">Ayuda y Gu√≠a de Uso</h3>
                                    <p class="card-subtitle" data-i18n="set_help_subtitle">Entiende c√≥mo funciona
                                        ReparApp PRO</p>
                                </div>
                                <div>üìñ</div>
                            </div>
                            <div class="card-body">
                                <div id="help-content-guide" class="help-section">
                                    <p class="text-muted" data-i18n="set_help_loading">Cargando gu√≠a...</p>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <div>
                                    <h3 class="card-title" data-i18n="set_faq_title">Preguntas Frecuentes (FAQ)</h3>
                                    <p class="card-subtitle" data-i18n="set_faq_subtitle">Soluciones r√°pidas a dudas
                                        comunes</p>
                                </div>
                                <div>‚ùì</div>
                            </div>
                            <div class="card-body">
                                <div id="help-content-faq" class="help-section">
                                    <p class="text-muted" data-i18n="set_faq_loading">Cargando preguntas frecuentes...
                                    </p>
                                </div>

                                <div
                                    style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed var(--border-color); text-align: center;">
                                    <p style="color: var(--text-secondary); margin-bottom: 15px;"
                                        data-i18n="set_help_contact">¬øNo has encontrado la
                                        respuesta? Contacta con el desarrollador</p>
                                    <a href="mailto:soporte@reparapp.com" class="btn btn-primary"
                                        style="display: inline-flex; width: auto; padding: 12px 30px; font-weight: 600;">
                                        üìß <span data-i18n="set_help_btn_support">Contactar Soporte</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Auth Screen Overlay -->
    <div id="auth-screen" class="auth-screen-overlay" style="z-index: 30005 !important;">
        <div class="auth-container">
            <!-- Columna Jefe -->
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-icon">üëë</div>
                    <h2 data-i18n="auth_admin_title">Acceso Jefe</h2>
                    <p data-i18n="auth_admin_subtitle">Panel de Administraci√≥n</p>
                </div>

                <form id="auth-form-jefe" onsubmit="authUI.handleAuthJefe(event)">
                    <div class="form-group" style="position: relative; z-index: 50;">
                        <div class="input-wrapper" style="position: relative;">
                            <span class="material-icons"
                                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);">email</span>
                            <input type="email" id="auth-email-jefe" class="form-input" placeholder="Email" required
                                autofocus style="padding-left: 40px; cursor: text;" data-i18n-placeholder="auth_email">
                        </div>
                    </div>

                    <div class="form-group" style="position: relative; z-index: 50;">
                        <div class="input-wrapper" style="position: relative;">
                            <span class="material-icons"
                                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);">lock</span>
                            <input type="password" id="auth-password-jefe" class="form-input" placeholder="Contrase√±a"
                                required style="padding-left: 40px; cursor: text;"
                                data-i18n-placeholder="auth_password">
                        </div>
                    </div>

                    <div id="auth-error-jefe" class="auth-error"></div>

                    <div style="margin-top: 20px;">
                        <button type="submit" class="btn btn-primary full-width" style="margin-bottom: 15px;"
                            data-i18n="auth_login_admin">
                            Entrar como Jefe
                        </button>
                    </div>

                    <div style="text-align: center;">
                        <button type="button" id="btn-toggle-register" class="btn-link"
                            onclick="authUI.toggleMode(event)" style="display: block; margin: 0 auto 10px auto;"
                            data-i18n="auth_register_link">
                            ¬øNo tienes cuenta? Reg√≠strate
                        </button>
                    </div>

                    <div style="text-align: center;">
                        <button type="button" class="btn-link" onclick="authUI.showPinRecovery()"
                            style="font-size: 0.8rem; opacity: 0.7;" data-i18n="auth_forgot_pin">
                            ¬øOlvidaste tu PIN?
                        </button>
                    </div>

                    <div style="margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                        <p style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 8px;"
                            data-i18n="offline_desc">
                            ¬øSin Internet?
                        </p>
                        <div class="input-wrapper" style="position: relative;">
                            <span class="material-icons"
                                style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 18px;">dialpad</span>
                            <input type="password" id="auth-pin-admin" class="form-input"
                                placeholder="PIN Offline (Jefe)" maxlength="4"
                                style="padding-left: 35px; text-align: center; letter-spacing: 4px;"
                                data-i18n-placeholder="auth_pin_offline">
                        </div>
                    </div>
                </form>
            </div>

            <!-- Columna Empleado -->
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-icon empleado">üõ†Ô∏è</div>
                    <h3 data-i18n="auth_tech_title">Acceso T√©cnico</h3>
                    <p data-i18n="auth_tech_subtitle">Introduce tu PIN de 4 d√≠gitos</p>
                </div>
                <div class="pin-entry">
                    <div class="pin-display">
                        <div class="pin-dot"></div>
                        <div class="pin-dot"></div>
                        <div class="pin-dot"></div>
                        <div class="pin-dot"></div>
                    </div>
                    <input type="password" id="auth-pin" maxlength="4" class="pin-hidden-input" pattern="\d*"
                        inputmode="numeric" style="width: 1px; height: 1px; left: 0;">

                    <div class="pin-keypad">
                        <button class="key" data-val="1">1</button>
                        <button class="key" data-val="2">2</button>
                        <button class="key" data-val="3">3</button>
                        <button class="key" data-val="4">4</button>
                        <button class="key" data-val="5">5</button>
                        <button class="key" data-val="6">6</button>
                        <button class="key" data-val="7">7</button>
                        <button class="key" data-val="8">8</button>
                        <button class="key" data-val="9">9</button>
                        <button class="key empty"></button>
                        <button class="key" data-val="0">0</button>
                        <button class="key delete">‚å´</button>
                    </div>
                </div>
                <div id="auth-error-empleado" class="auth-error" style="display: none;"></div>
                <button id="btn-auth-empleado" class="btn btn-secondary"
                    style="width: 100%; justify-content: center; margin-top: 20px;" data-i18n="auth_login_tech">
                    Entrar como T√©cnico
                </button>
            </div>
        </div>

        <style>
            .auth-container {
                display: flex;
                gap: 30px;
                flex-wrap: wrap;
                justify-content: center;
                align-items: stretch;
                max-width: 1000px;
                width: 95%;
                padding: 20px;
                animation: zoomIn 0.4s ease-out;
            }

            .auth-card {
                flex: 1;
                min-width: 320px;
                max-width: 400px;
                background: rgba(var(--bg-card-rgb), 0.9);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 24px;
                padding: 40px;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                display: flex;
                flex-direction: column;
            }

            .auth-header {
                text-align: center;
                margin-bottom: 30px;
            }

            .auth-icon {
                font-size: 3rem;
                margin-bottom: 15px;
                height: 80px;
                width: 80px;
                background: var(--bg-secondary);
                border-radius: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-left: auto;
                margin-right: auto;
                box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.1);
            }

            .auth-header h3 {
                font-size: 1.5rem;
                font-weight: 700;
                margin-bottom: 5px;
            }

            .auth-header p {
                color: var(--text-secondary);
                font-size: 0.9rem;
            }

            .auth-error {
                color: var(--status-error);
                background: rgba(255, 71, 87, 0.1);
                padding: 10px;
                border-radius: 8px;
                font-size: 0.85rem;
                margin-bottom: 15px;
                text-align: center;
                border: 1px solid rgba(255, 71, 87, 0.2);
            }

            /* PIN Styling */
            .pin-entry {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
                position: relative;
            }

            .pin-display {
                display: flex;
                gap: 15px;
            }

            .pin-dot {
                width: 18px;
                height: 18px;
                border-radius: 50%;
                border: 2px solid var(--border-color);
                transition: all 0.2s ease;
            }

            .pin-dot.filled {
                background: var(--accent-color);
                border-color: var(--accent-color);
                box-shadow: 0 0 10px var(--accent-color);
                transform: scale(1.1);
            }

            .pin-hidden-input {
                position: absolute;
                opacity: 0;
                top: 0;
                left: 50%;
                transform: translateX(-50%);
                width: 100px;
                height: 40px;
                cursor: pointer;
                z-index: 10;
            }

            .pin-keypad {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
                width: 100%;
                max-width: 240px;
            }

            .key {
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 15px;
                font-size: 1.25rem;
                font-weight: 600;
                color: var(--text-primary);
                cursor: pointer;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .key:hover {
                background: var(--bg-primary);
                border-color: var(--accent-color);
                transform: translateY(-2px);
            }

            .key:active {
                transform: scale(0.95);
            }

            .key.empty {
                background: transparent;
                border: none;
                pointer-events: none;
            }

            .key.delete {
                font-size: 1rem;
                color: var(--status-error);
            }

            @keyframes zoomIn {
                from {
                    opacity: 0;
                    transform: scale(0.95);
                }

                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
        </style>
    </div>



    <!-- Lock Screen Overlay -->
    <div id="lock-screen"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-body); z-index: 20010; display: none; flex-direction: column; align-items: center; justify-content: center;">
        <div style="text-align: center; margin-bottom: var(--spacing-xl);">
            <div
                style="width: 80px; height: 80px; background: rgba(0, 255, 198, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; border: 2px solid var(--electric-cyan);">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                    stroke="var(--electric-cyan)" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>
            <h1 style="color: var(--text-primary); font-size: 1.5rem; margin-bottom: var(--spacing-sm);"
                data-i18n="lock_title">App Bloqueada
            </h1>
            <p style="color: var(--text-secondary);" data-i18n="lock_subtitle">Introduce tu c√≥digo de seguridad</p>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: var(--spacing-lg);">
            <input type="password" id="lock-pin" maxlength="4"
                style="background: var(--bg-card); border: 2px solid var(--border-color); color: var(--text-primary); font-size: 2rem; width: 160px; text-align: center; padding: 10px; border-radius: 8px; letter-spacing: 8px;">
        </div>

        <button class="btn btn-primary" id="btn-unlock" style="min-width: 160px; font-size: 1rem; padding: 12px;"
            data-i18n="lock_btn_unlock">Desbloquear</button>
        <p id="lock-error" style="color: var(--status-pending); margin-top: var(--spacing-md); display: none;"
            data-i18n="lock_error">PIN
            incorrecto</p>
    </div>

    <!-- Modal Cliente -->
    <div class="modal-overlay" id="modal-cliente">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-cliente-title" data-i18n="mod_client_new">Nuevo Cliente</h2>
                <button class="modal-close" data-close-modal="modal-cliente">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="form-cliente">
                <div class="modal-body">
                    <input type="hidden" id="cliente-id">

                    <!-- Secci√≥n: Datos Personales -->
                    <h4
                        style="color: var(--electric-blue); margin-bottom: var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Datos Personales</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="cli_field_name">Nombre *</label>
                            <input type="text" class="form-input" id="cliente-nombre" required placeholder="Nombre"
                                data-i18n-placeholder="cli_field_name_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="cli_field_lastname">Apellido</label>
                            <input type="text" class="form-input" id="cliente-apellido" placeholder="Apellido"
                                data-i18n-placeholder="cli_field_lastname_placeholder">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="cli_field_dni">DNI / NIF</label>
                            <input type="text" class="form-input" id="cliente-dni" placeholder="12345678A"
                                data-i18n-placeholder="cli_field_dni_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="cli_field_phone">Tel√©fono *</label>
                            <input type="tel" class="form-input" id="cliente-telefono" required
                                placeholder="N√∫mero de tel√©fono" data-i18n-placeholder="cli_field_phone_placeholder">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="cli_field_email">Email</label>
                        <input type="email" class="form-input" id="cliente-email" placeholder="correo@ejemplo.com"
                            data-i18n-placeholder="cli_field_email_placeholder">
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="cli_field_address">Direcci√≥n</label>
                        <input type="text" class="form-input" id="cliente-direccion" placeholder="Direcci√≥n del cliente"
                            data-i18n-placeholder="cli_field_address_placeholder">
                    </div>

                    <!-- Secci√≥n: Notas -->
                    <h4
                        style="color: var(--electric-cyan); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Notas Adicionales</h4>

                    <div class="form-group">
                        <label class="form-label">Notas</label>
                        <textarea class="form-textarea" id="cliente-notas"
                            placeholder="Observaciones, contrase√±as, informaci√≥n adicional..."
                            data-i18n-placeholder="cli_field_notes_placeholder"></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-close-modal="modal-cliente"
                            data-i18n="mod_cancel">Cancelar</button>
                        <button type="submit" class="btn btn-primary" data-i18n="mod_save">Guardar</button>
                    </div>
            </form>
        </div>
    </div>

    <!-- Modal Reparaci√≥n -->
    <div class="modal-overlay" id="modal-reparacion">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-reparacion-title" data-i18n="mod_repair_new">Nueva Reparaci√≥n</h2>
                <button class="modal-close" data-close-modal="modal-reparacion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="form-reparacion">
                <div class="modal-body">
                    <input type="hidden" id="reparacion-id">

                    <!-- Secci√≥n: Cliente -->
                    <h4
                        style="color: var(--electric-blue); margin-bottom: var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Cliente</h4>

                    <div class="form-group">
                        <label class="form-label">Cliente *</label>
                        <select class="form-select" id="reparacion-cliente" required>
                            <option value="">Seleccionar cliente...</option>
                        </select>
                    </div>

                    <!-- Secci√≥n: Dispositivo -->
                    <h4
                        style="color: var(--electric-purple); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Dispositivo</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_type">Tipo</label>
                            <select class="form-select" id="reparacion-dispositivo">
                                <option value="" data-i18n="rep_type_none">Sin especificar</option>
                                <option value="movil" data-i18n="rep_type_mobile">M√≥vil</option>
                                <option value="tablet" data-i18n="rep_type_tablet">Tablet</option>
                                <option value="ordenador" data-i18n="rep_type_pc">Ordenador</option>
                                <option value="videoconsola" data-i18n="rep_type_console">Videoconsola</option>
                                <option value="otro" data-i18n="rep_type_other">Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_brand">Marca</label>
                            <input type="text" class="form-input" id="reparacion-marca" placeholder="Samsung, Apple..."
                                data-i18n-placeholder="rep_field_brand_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_model">Modelo</label>
                            <input type="text" class="form-input" id="reparacion-modelo" placeholder="iPhone 15..."
                                data-i18n-placeholder="rep_field_model_placeholder">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="rep_field_imei">IMEI / N√∫mero de Serie</label>
                        <input type="text" class="form-input" id="reparacion-imei"
                            placeholder="15 d√≠gitos o ID de serie" data-i18n-placeholder="rep_field_imei_placeholder">
                    </div>

                    <!-- Secci√≥n: Reparaci√≥n -->
                    <h4
                        style="color: var(--electric-cyan); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Detalles de la Reparaci√≥n</h4>

                    <div class="form-group">
                        <label class="form-label" data-i18n="rep_field_problem">Problema *</label>
                        <textarea class="form-textarea" id="reparacion-problema" required
                            placeholder="Describe el problema del dispositivo..."
                            data-i18n-placeholder="rep_field_problem_placeholder"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="rep_field_solution">Soluci√≥n</label>
                        <textarea class="form-textarea" id="reparacion-solucion"
                            placeholder="Describe la soluci√≥n aplicada..."
                            data-i18n-placeholder="rep_field_solution_placeholder"></textarea>
                    </div>

                    <!-- Secci√≥n: Repuestos Utilizados -->
                    <h4
                        style="color: var(--warning); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Repuestos y Materiales</h4>
                    <div id="reparacion-parts-container"
                        style="background: rgba(255, 255, 255, 0.03); border-radius: 8px; padding: var(--spacing-md); border: 1px solid var(--border-color); margin-bottom: var(--spacing-lg);">
                        <div class="form-group" style="margin-bottom: var(--spacing-md);">
                            <div id="repair-parts-search-container">
                                <!-- Widget de b√∫squeda de productos se inyectar√° aqu√≠ -->
                            </div>
                        </div>
                        <div id="repair-parts-list" style="margin-top: 10px;">
                            <table class="data-table" style="font-size: 0.85rem; background: transparent;">
                                <thead style="background: rgba(255,255,255,0.05);">
                                    <tr>
                                        <th style="padding: 8px;">Repuesto</th>
                                        <th style="width: 60px; text-align: center; padding: 8px;">Cant.</th>
                                        <th style="width: 80px; text-align: right; padding: 8px;">Precio</th>
                                        <th style="width: 40px; padding: 8px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="repair-parts-body">
                                    <!-- Filas de repuestos din√°micas -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="rep_field_pin">PIN / Patr√≥n de Desbloqueo</label>
                        <input type="text" class="form-input" id="reparacion-pin"
                            placeholder="PIN, patr√≥n o contrase√±a del dispositivo"
                            data-i18n-placeholder="rep_field_unlock_placeholder">
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="rep_field_notes">Notas Adicionales</label>
                        <textarea class="form-textarea" id="reparacion-notas"
                            placeholder="Observaciones, accesorios entregados, informaci√≥n extra..."
                            data-i18n-placeholder="rep_field_notes_placeholder"></textarea>
                    </div>

                    <!-- Secci√≥n: Checklist de Recepci√≥n -->
                    <h4
                        style="color: var(--status-completed); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Checklist de Recepci√≥n</h4>
                    <div id="reparacion-checklist"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; margin-bottom: var(--spacing-lg);">
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-power" value="power"> <span
                                data-i18n="check_power">Encendido</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-touch" value="touch"> <span data-i18n="check_touch">Touch /
                                T√°ctil</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-display" value="display"> <span
                                data-i18n="check_display">Display / LCD</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-charging" value="charging"> <span
                                data-i18n="check_charging">Carga</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-wifi" value="wifi"> <span data-i18n="check_wifi">WiFi /
                                Red</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-audio" value="audio"> <span data-i18n="check_audio">Audio /
                                Mic</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-cameras" value="cameras"> <span
                                data-i18n="check_cameras">C√°maras</span>
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 8px; font-size: 0.85rem; cursor: pointer;">
                            <input type="checkbox" name="chk-buttons" value="buttons"> <span
                                data-i18n="check_buttons">Botones</span>
                        </label>
                    </div>

                    <!-- Secci√≥n: Fotos del Equipo -->
                    <h4 style="color: var(--electric-purple); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;"
                        data-i18n="rep_section_photos">
                        Fotos del Equipo (Webcam / Archivo)</h4>
                    <div id="repair-photos-container"
                        style="background: rgba(255, 255, 255, 0.05); border-radius: 8px; padding: 15px; margin-bottom: var(--spacing-lg);">

                        <div id="repair-camera-preview"
                            style="display: none; position: relative; margin-bottom: 10px; border-radius: 8px; overflow: hidden; background: #000; border: 1px solid var(--electric-purple);">
                            <video id="repair-video" autoplay playsinline
                                style="width: 100%; height: auto; display: block;"></video>
                            <canvas id="repair-photo-canvas" style="display: none;"></canvas>
                            <div
                                style="position: absolute; bottom: 10px; left: 0; right: 0; display: flex; justify-content: center; gap: 10px; z-index: 10;">
                                <button type="button" class="btn btn-primary btn-sm" onclick="repUI.capturePhoto()"
                                    data-i18n="btn_capture">üì∏
                                    Capturar</button>
                                <button type="button" class="btn btn-secondary btn-sm" onclick="repUI.stopCamera()"
                                    data-i18n="btn_cancel">Cancelar</button>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 15px;">
                            <button type="button" class="btn btn-secondary" onclick="repUI.startCamera()"
                                style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.8rem;"
                                data-i18n="btn_webcam">
                                üì∑ Webcam
                            </button>
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('repair-photo-upload').click()"
                                style="flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.8rem;"
                                data-i18n="btn_file">
                                üìÅ Archivo
                            </button>
                            <input type="file" id="repair-photo-upload" hidden accept="image/*" multiple
                                onchange="repUI.handlePhotoUpload(this.files)">
                        </div>

                        <p
                            style="font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 8px; font-style: italic; opacity: 0.8;">
                            üí° Tip: Puedes pegar (Ctrl+V) una imagen directamente desde WhatsApp Desktop.
                        </p>

                        <div id="repair-photo-gallery"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px;">
                            <!-- Fotos din√°micas -->
                        </div>
                    </div>

                    <!-- Secci√≥n: Firma del Cliente -->
                    <h4
                        style="color: var(--electric-cyan); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Firma de Aceptaci√≥n</h4>
                    <div style="background: white; border-radius: 8px; padding: 5px; margin-bottom: 10px;">
                        <canvas id="signature-pad" width="400" height="150"
                            style="width: 100%; height: 150px; cursor: crosshair; touch-action: none; background: #fff;"></canvas>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg);">
                        <button type="button" id="btn-clear-signature" class="btn btn-sm"
                            style="color: var(--danger); background: rgba(255, 71, 87, 0.1);">
                            üóëÔ∏è Limpiar Firma
                        </button>
                        <span style="font-size: 0.75rem; color: var(--text-secondary);">El cliente acepta las
                            condiciones de reparaci√≥n.</span>
                    </div>

                    <!-- Estado y Precio al final -->
                    <h4
                        style="color: var(--status-pending); margin: var(--spacing-lg) 0 var(--spacing-md); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px;">
                        Estado y Precio</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_status">Estado</label>
                            <select class="form-select" id="reparacion-estado">
                                <option value="recibido" data-i18n="st_recibido">Recibido</option>
                                <option value="diagnostico" data-i18n="st_diagnostico">En Diagn√≥stico</option>
                                <option value="reparando" data-i18n="st_reparando">Reparando</option>
                                <option value="listo" data-i18n="st_listo">Listo</option>
                                <option value="cancelado" data-i18n="st_cancelado">Cancelado</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_price">Precio Estimado (‚Ç¨)</label>
                            <input type="text" inputmode="decimal" class="form-input" id="reparacion-precio"
                                placeholder="0.00" data-i18n-placeholder="num_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_price_final">Precio Final (‚Ç¨)</label>
                            <input type="text" inputmode="decimal" class="form-input" id="reparacion-precio-final"
                                placeholder="0.00" data-i18n-placeholder="num_placeholder">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_tech">Asignar a T√©cnico</label>
                            <select class="form-select" id="reparacion-tecnico">
                                <option value="" data-i18n="rep_tech_none">Sin asignar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="rep_field_due_date">Fecha de Entrega</label>
                            <input type="date" class="form-input" id="reparacion-fecha-entrega">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-close-modal="modal-reparacion"
                        data-i18n="mod_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="mod_save">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Producto (Inventario) -->
    <div class="modal-overlay" id="modal-producto">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-producto-title" data-i18n="mod_product_new">Nuevo Producto</h2>
                <button class="modal-close" data-close-modal="modal-producto">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="form-producto">
                <div class="modal-body">
                    <input type="hidden" id="producto-id">

                    <div class="form-group">
                        <label class="form-label" data-i18n="stk_field_type">Tipo</label>
                        <select class="form-select" id="producto-tipo"
                            onchange="window.inventoryUI.toggleStockFields()">
                            <option value="product" data-i18n="stk_type_product">Producto F√≠sico</option>
                            <option value="service" data-i18n="stk_type_service">Servicio</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-i18n="stk_field_name">Nombre del Producto *</label>
                        <input type="text" class="form-input" id="producto-nombre" required
                            placeholder="Ej: Pantalla iPhone 11" autocomplete="off"
                            data-i18n-placeholder="stk_field_name_placeholder">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_sku">SKU / C√≥digo</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" class="form-input" id="producto-sku" placeholder="C√≥digo de barras"
                                    autocomplete="off" data-i18n-placeholder="stk_field_sku_placeholder">
                                <button type="button" class="btn btn-secondary btn-icon" id="btn-scan-sku"
                                    title="Escanear C√≥digo" data-i18n-title="title_scan">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
                                        <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
                                        <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
                                        <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
                                        <rect x="7" y="7" width="10" height="10" rx="1"></rect>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_cat">Categor√≠a</label>
                            <input type="text" class="form-input" id="producto-categoria" list="categorias-list"
                                placeholder="Ej: Pantallas" autocomplete="off"
                                data-i18n-placeholder="stk_field_cat_placeholder">
                            <datalist id="categorias-list">
                                <option value="Pantallas">
                                <option value="Bater√≠as">
                                <option value="Cables">
                                <option value="Fundas">
                                <option value="Protectores">
                                <option value="Componentes">
                                <option value="Otros">
                            </datalist>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_buy_price">Precio Compra (‚Ç¨)</label>
                            <input type="number" step="0.01" class="form-input" id="producto-coste" placeholder="0.00"
                                data-i18n-placeholder="num_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_sell_price">Precio Venta (‚Ç¨) *</label>
                            <input type="number" step="0.01" class="form-input" id="producto-precio" required
                                placeholder="0.00" data-i18n-placeholder="num_placeholder">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_stock">Stock Actual *</label>
                            <input type="number" class="form-input" id="producto-stock" required value="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="stk_field_stock_min">Stock M√≠nimo</label>
                            <input type="number" class="form-input" id="producto-stock-min" value="2"
                                title="Alerta cuando baje de esta cantidad">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-close-modal="modal-producto"
                        data-i18n="mod_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="mod_save">Guardar Producto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Factura -->
    <div class="modal-overlay" id="modal-factura">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-factura-title" data-i18n="inv_new">Nueva Factura</h2>
                <button class="modal-close" data-close-modal="modal-factura">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <form id="form-factura">
                <div class="modal-body">
                    <input type="hidden" id="factura-id">

                    <!-- Secci√≥n: Cliente -->


                    <div class="form-group">
                        <label class="form-label">Cliente *</label>
                        <select class="form-select" id="factura-cliente" required>
                            <option value="">Seleccionar cliente...</option>
                        </select>
                    </div>

                    <!-- Datos del cliente (auto-rellenados) -->
                    <div id="factura-cliente-info"
                        style="display: none; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                        <div
                            style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); font-size: 0.9rem;">
                            <div><strong style="color: var(--electric-blue);">Nombre:</strong> <span
                                    id="factura-info-nombre">-</span></div>
                            <div><strong style="color: var(--electric-blue);">DNI:</strong> <span
                                    id="factura-info-dni">-</span></div>
                            <div><strong style="color: var(--electric-blue);">Tel√©fono:</strong> <span
                                    id="factura-info-telefono">-</span></div>
                            <div><strong style="color: var(--electric-blue);">Email:</strong> <span
                                    id="factura-info-email">-</span></div>
                            <div style="grid-column: 1 / -1;"><strong
                                    style="color: var(--electric-blue);">Direcci√≥n:</strong> <span
                                    id="factura-info-direccion">-</span></div>
                        </div>
                    </div>

                    <!-- Secci√≥n: Datos Factura -->


                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                        <div class="form-group">
                            <label class="form-label" data-i18n="inv_field_number">N√∫mero de Factura</label>
                            <input type="text" class="form-input" id="factura-numero" placeholder="FAC-2026-001"
                                data-i18n-placeholder="inv_number_placeholder">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="ges_field_date">Fecha</label>
                            <div style="display: flex; gap: var(--spacing-sm);">
                                <input type="date" class="form-input" id="factura-fecha" style="flex: 1;">
                                <button type="button" class="btn-icon" id="btn-edit-fecha" title="Cambiar fecha">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Secci√≥n: Conceptos -->


                    <div id="factura-lineas">
                        <!-- Las l√≠neas se a√±aden din√°micamente -->
                    </div>

                    <button type="button" class="btn btn-secondary" id="btn-add-linea"
                        style="margin-bottom: var(--spacing-lg);" data-i18n="inv_add_line">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" width="16" height="16">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        A√±adir Concepto
                    </button>

                    <!-- Totales -->
                    <div
                        style="background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: var(--spacing-md);">
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm); align-items: center;">
                            <span data-i18n="inv_subtotal">Subtotal:</span>
                            <span id="factura-subtotal">0.00 ‚Ç¨</span>
                        </div>

                        <!-- Impuesto Din√°mico -->
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm); align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="factura-tax-label" data-i18n="inv_tax">Impuesto:</span>
                                <select id="factura-tax-rate" class="form-select"
                                    style="padding: 2px 6px; width: auto; font-size: 0.8rem;"
                                    onchange="window.invoicesUI.updateTotales()">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <span id="factura-iva">0.00 ‚Ç¨</span>
                        </div>

                        <!-- Retenci√≥n Din√°mica -->
                        <div id="factura-retention-row"
                            style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-sm); align-items: center;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span id="factura-ret-label" data-i18n="inv_ret">Retenci√≥n:</span>
                                <select id="factura-ret-rate" class="form-select"
                                    style="padding: 2px 6px; width: auto; font-size: 0.8rem;"
                                    onchange="window.invoicesUI.updateTotales()">
                                    <!-- Populated dynamically -->
                                </select>
                            </div>
                            <span id="factura-retention" style="color: var(--status-rejected);">-0.00 ‚Ç¨</span>
                        </div>

                        <div
                            style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700; color: var(--electric-cyan); border-top: 1px solid var(--border-color); padding-top: var(--spacing-sm); align-items: center;">
                            <span data-i18n="inv_total">TOTAL:</span>
                            <span id="factura-total">0.00 ‚Ç¨</span>
                        </div>
                    </div>

                    <!-- Notas -->
                    <div class="form-group" style="margin-top: var(--spacing-lg);">
                        <label class="form-label">Notas</label>
                        <textarea class="form-textarea" id="factura-notas"
                            placeholder="Notas adicionales para la factura..."
                            data-i18n-placeholder="inv_notes_placeholder"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-close-modal="modal-factura"
                        data-i18n="mod_cancel">Cancelar</button>
                    <button type="submit" class="btn btn-primary" data-i18n="inv_btn_save">Guardar Factura</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Eliminado modal duplicado -->

    <!-- Modal Scanner -->
    <div class="modal-overlay" id="modal-scanner" style="z-index: 4000;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="scan_title">Escanear C√≥digo</h2>
                <button class="modal-close" data-close-modal="modal-scanner">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="padding: 0;">
                <div id="reader" style="width: 100%; min-height: 300px; background: black;"></div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <p style="color: var(--text-secondary); font-size: 0.85rem;" data-i18n="scan_help">Apunta la c√°mara al
                    c√≥digo de barras</p>
            </div>
        </div>
    </div>

    <!-- Custom Animated Confirm Modal -->
    <div id="modal-confirm" class="modal-overlay">
        <div class="modal" id="modal-confirm-content">
            <div class="modal-body" style="padding: 20px; text-align: center;">
                <div style="margin-bottom: 20px;">
                    <span style="font-size: 3rem; display: block; margin-bottom: 10px;">üõ°Ô∏è</span>
                    <!-- Icono decorativo -->
                    <h3 id="confirm-title" style="margin: 0; font-size: 1.5rem; color: #1f2937; letter-spacing: -0.5px;"
                        data-i18n="dlg_confirm_title">Confirmar</h3>
                </div>
                <p id="confirm-message" style="margin: 0 0 30px 0; color: #6b7280; font-size: 1.1rem; line-height: 1.5;"
                    data-i18n="dlg_confirm_msg">¬øEst√°s seguro de
                    continuar?</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button id="btn-confirm-cancel" class="btn"
                        style="background: #f3f4f6; color: #374151; border: none; font-weight: 600; padding: 12px; border-radius: 12px; cursor: pointer; transition: all 0.2s;"
                        data-i18n="dlg_cancel">
                        Cancelar
                    </button>
                    <button id="btn-confirm-ok" class="btn"
                        style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; font-weight: 600; padding: 12px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(220, 38, 38, 0.4); transition: all 0.2s;"
                        data-i18n="dlg_ok">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Informativo Mejorado -->
    <div id="modal-info" class="modal-overlay">
        <div class="modal info-modal-container">
            <div class="info-modal-content">
                <!-- Icono animado -->
                <div id="info-modal-icon" class="info-modal-icon">‚úÖ</div>

                <!-- T√≠tulo -->
                <h2 id="info-modal-title" class="info-modal-title" data-i18n="dlg_info_title">Informaci√≥n</h2>

                <!-- Contenido din√°mico -->
                <div id="info-modal-content" class="info-modal-body">
                    <p>Mensaje aqu√≠</p>
                </div>

                <!-- Bot√≥n -->
                <button id="info-modal-ok" class="info-modal-btn" data-i18n="dlg_ok">
                    Aceptar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Prompt Moderno -->
    <div id="modal-prompt" class="modal-overlay">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-body" style="padding: 30px; text-align: center;">
                <div style="margin-bottom: 20px;">
                    <span id="prompt-icon" style="font-size: 3rem; display: block; margin-bottom: 10px;">‚úèÔ∏è</span>
                    <h3 id="prompt-title"
                        style="margin: 0; font-size: 1.4rem; color: var(--text-primary); letter-spacing: -0.5px;"
                        data-i18n="dlg_prompt_title">
                        Introduce un valor</h3>
                </div>
                <p id="prompt-message"
                    style="margin: 0 0 20px 0; color: var(--text-secondary); font-size: 1rem; line-height: 1.5;"></p>
                <input type="text" id="prompt-input" class="form-input"
                    style="text-align: center; font-size: 1.1rem; padding: 14px; margin-bottom: 25px;" placeholder="">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button id="btn-prompt-cancel" class="btn"
                        style="background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); font-weight: 600; padding: 12px; border-radius: 12px; cursor: pointer; transition: all 0.2s;"
                        data-i18n="dlg_cancel">
                        Cancelar
                    </button>
                    <button id="btn-prompt-ok" class="btn"
                        style="background: linear-gradient(135deg, var(--electric-blue) 0%, var(--electric-purple) 100%); color: white; border: none; font-weight: 600; padding: 12px; border-radius: 12px; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.4); transition: all 0.2s;"
                        data-i18n="dlg_ok">
                        Aceptar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- Scripts -->
    <script src="js/utils/csv.js"></script>
    <script src="js/utils/file-sync.js"></script>

    <script src="js/utils/google-drive.js"></script>
    <!-- Scanner Library -->
    <script src="js/libs/html5-qrcode.min.js"></script>

    <!-- Setup Wizard Overlay -->
    <div id="setup-wizard-overlay" class="modal-overlay"
        style="z-index: 40000; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); display: none;">
        <div class="modal"
            style="max-width: 500px; padding: 0; overflow: hidden; border: 1px solid rgba(0, 255, 198, 0.2); background: var(--bg-card);">
            <div id="wizard-steps-container">
                <!-- Step 1: Welcome -->
                <div class="wizard-step" data-step="1" style="padding: 40px; text-align: center;">
                    <div style="font-size: 4rem; margin-bottom: 20px;">üöÄ</div>
                    <h2 style="font-size: 1.8rem; margin-bottom: 15px; background: linear-gradient(135deg, #00ffcc, #3399ff); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;"
                        data-i18n="wiz_welcome_title">
                        ¬°Bienvenido a ReparApp!</h2>
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 30px;"
                        data-i18n="wiz_welcome_subtitle">
                        Has entrado con el acceso de rescate. Vamos a configurar tu negocio en 2 minutos para que puedas
                        empezar a trabajar.
                    </p>
                    <button class="btn btn-primary full-width" onclick="setupWizard.nextStep()"
                        data-i18n="wiz_start">Empezar
                        Configuraci√≥n</button>
                </div>

                <!-- Step 2: Shop Info -->
                <div class="wizard-step" data-step="2" style="padding: 30px; display: none;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                        <span style="font-size: 2rem;">üè¢</span>
                        <h2 style="margin: 0; font-size: 1.4rem;" data-i18n="wiz_shop_title">Datos de tu Negocio</h2>
                    </div>
                    <form id="wizard-form-shop">
                        <div class="form-group">
                            <label class="form-label" data-i18n="wiz_shop_name">Nombre Comercial</label>
                            <input type="text" id="wizard-shop-name" class="form-input"
                                placeholder="Ej: Reparaciones R√°pidas" required data-i18n-placeholder="wiz_shop_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="wiz_shop_nif">NIF / CIF</label>
                            <input type="text" id="wizard-shop-nif" class="form-input" placeholder="B12345678"
                                data-i18n-placeholder="wiz_shop_nif">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="wiz_shop_address">Direcci√≥n</label>
                            <input type="text" id="wizard-shop-address" class="form-input"
                                placeholder="Calle Ejemplo, 12" data-i18n-placeholder="wiz_shop_address">
                        </div>
                        <div style="margin-top: 30px; display: flex; gap: 10px;">
                            <button type="button" class="btn btn-secondary" onclick="setupWizard.prevStep()"
                                data-i18n="wiz_prev">Atr√°s</button>
                            <button type="submit" class="btn btn-primary" style="flex: 1;"
                                data-i18n="wiz_next">Siguiente</button>
                        </div>
                    </form>
                </div>

                <!-- Step 3: Admin User -->
                <div class="wizard-step" data-step="3" style="padding: 30px; display: none;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 25px;">
                        <span style="font-size: 2rem;">üë§</span>
                        <h2 style="margin: 0; font-size: 1.4rem;" data-i18n="wiz_admin_title">Crea tu Administrador</h2>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 20px;"
                        data-i18n="wiz_admin_subtitle">
                        Define un nombre y un PIN de 4 d√≠gitos para tu cuenta personal. El PIN '1234' se eliminar√°.
                    </p>
                    <form id="wizard-form-admin">
                        <div class="form-group">
                            <label class="form-label" data-i18n="wiz_admin_name">Tu Nombre</label>
                            <input type="text" id="wizard-admin-name" class="form-input" placeholder="Ej: David P√©rez"
                                required data-i18n-placeholder="wiz_admin_name">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="wiz_admin_pin">Tu PIN (4 d√≠gitos)</label>
                            <input type="password" id="wizard-admin-pin" class="form-input" placeholder="****"
                                maxlength="4" pattern="\d{4}" inputmode="numeric" required
                                style="text-align: center; font-size: 1.5rem; letter-spacing: 10px;"
                                data-i18n-placeholder="****">
                        </div>
                        <div style="margin-top: 30px; display: flex; gap: 10px;">
                            <button type="button" class="btn btn-secondary" onclick="setupWizard.prevStep()"
                                data-i18n="wiz_prev">Atr√°s</button>
                            <button type="submit" class="btn btn-primary"
                                style="flex: 1; background: var(--status-success) !important;"
                                data-i18n="wiz_finish">Finalizar y
                                Reiniciar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- License Verification Overlay -->
    <div id="license-overlay"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #0f172a; z-index: 100000; flex-direction: column; align-items: center; justify-content: center; color: white;">
        <div
            style="background: #1e293b; padding: 40px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); width: 90%; max-width: 450px; text-align: center; border: 1px solid #334155;">
            <div style="font-size: 3rem; margin-bottom: 20px;">üõ°Ô∏è</div>
            <h2 style="margin-bottom: 10px; font-size: 1.8rem; color: white;" data-i18n="lic_title">Activaci√≥n Requerida
            </h2>
            <p style="color: #94a3b8; margin-bottom: 30px;" data-i18n="lic_subtitle">Esta copia de ReparApp PRO no est√°
                activada.</p>

            <div style="text-align: left; margin-bottom: 20px;">
                <label style="display: block; color: #cbd5e1; margin-bottom: 5px; font-size: 0.9rem;"
                    data-i18n="lic_company">Nombre de Empresa
                    / Titular</label>
                <input type="text" id="lic-name" placeholder="Ej: Servicios R√°pidos SL"
                    style="width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px;"
                    data-i18n-placeholder="lic_company">
            </div>

            <div style="text-align: left; margin-bottom: 30px;">
                <label style="display: block; color: #cbd5e1; margin-bottom: 5px; font-size: 0.9rem;"
                    data-i18n="lic_key">Clave de
                    Producto</label>
                <input type="text" id="lic-key" placeholder="XXXX-XXXX-XXXX-XXXX"
                    style="width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; font-family: monospace; letter-spacing: 1px; text-transform: uppercase;"
                    data-i18n-placeholder="lic_key">
            </div>

            <button id="btn-activate"
                style="width: 100%; padding: 14px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: transform 0.1s;"
                data-i18n="lic_activate">
                Activar Licencia
            </button>
            <p id="lic-error" style="color: #ef4444; margin-top: 15px; font-size: 0.9rem; display: none;"
                data-i18n="lic_error">‚ùå Clave
                incorrecta para este nombre</p>
        </div>
        <p style="margin-top: 30px; color: #475569; font-size: 0.8rem;" data-i18n="lic_support">Soporte:
            soporte@reparapp.com</p>
    </div>

    <!-- Main Scripts -->
    <script src="js/locales/es.js"></script>
    <script src="js/locales/en.js"></script>
    <script src="js/locales/fr.js"></script>
    <script src="js/locales/pt.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/license-manager.js"></script>
    <script src="js/ui/search-select.js"></script>
    <script src="js/database.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/sync_secure.js"></script>
    <script src="js/ui/navigation.js"></script>
    <script src="js/ui/clients.js"></script>
    <script src="js/ui/repairs_v2.js"></script> <!-- RENAMED -->
    <script src="js/ui/invoices.js"></script>
    <script src="js/ui/inventory.js"></script>
    <script src="js/ui/appointments.js"></script>
    <script src="js/ui/settings.js"></script>
    <script src="js/ui/manager.js?v=1.1.2"></script>
    <script src="js/ui/auth.js"></script>
    <script src="js/ui/progress.js"></script>
    <script src="js/ui/setup-wizard.js"></script>
    <script src="js/ui/help.js"></script>
    <script src="js/ui/pos.js"></script>
    <script src="js/utils/printer_v2.js"></script>
    <script src="js/app.js?v=1.1.2"></script>
</body>

</html>